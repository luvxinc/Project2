# 数据交互可视化 (Visuals) - 解析逻辑

> 文档版本: V1.0  
> 最后更新: 2026-01-12  
> 对应代码: `backend/apps/visuals/views.py`, `backend/core/services/visual_service.py`

---

## 一、架构总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     数据交互可视化 (Visuals Module)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                   前端 (Frontend Layer)                               │  │
│  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                  │  │
│  │  │ 日期筛选器  │   │  店铺筛选   │   │ 指标多选框  │                  │  │
│  │  └─────────────┘   └─────────────┘   └─────────────┘                  │  │
│  │                            ↓                                          │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │                    折线图 / 饼图 (ECharts)                       │  │  │
│  │  │  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐   │  │  │
│  │  │  │ 金额模式 │    │ 数量模式 │    │ 订单模式 │    │ 占比模式 │   │  │  │
│  │  │  └──────────┘    └──────────┘    └──────────┘    └──────────┘   │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                   后端 (Backend Layer)                                │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │                  VisualService (核心聚合服务)                    │  │  │
│  │  │  1. 从 Data_Clean_Log 读取数据                                   │  │  │
│  │  │  2. 向量化计算 (COGS/Fees/Shipping)                              │  │  │
│  │  │  3. 按时间粒度聚合 (日/周/月)                                    │  │  │
│  │  │  4. 按 Action 分组 Pivot                                         │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.1 目录结构

```
backend/apps/visuals/
├── views.py          # 视图层 (API 控制器)
├── urls.py           # 路由配置

backend/core/services/
└── visual_service.py # 可视化数据聚合服务

backend/templates/visuals/
└── index.html        # 可视化页面模板 (ECharts)
```

---

## 二、页面访问流程

### 2.1 入口与解锁

```
用户点击 "数据交互可视化"
        ↓
┌────────────────────────────────────────────────────────────────┐
│  middleware: 检查 session['visuals_unlocked']                  │
│  ├── 如果已解锁 → 直接显示可视化页面                           │
│  └── 如果未解锁 → 显示锁屏界面，要求输入密码                   │
└────────────────────────────────────────────────────────────────┘
        ↓
┌────────────────────────────────────────────────────────────────┐
│  解锁视图: unlock(request)                                     │
│  ├── SecurityPolicyManager.verify_action_request('btn_unlock_visuals')
│  ├── 验证通过 → session['visuals_unlocked'] = True            │
│  └── 验证失败 → 返回错误消息                                   │
└────────────────────────────────────────────────────────────────┘
        ↓
┌────────────────────────────────────────────────────────────────┐
│  可视化页面: index.html                                        │
│  ├── 日期范围选择器 (默认: 过去30天)                           │
│  ├── 店铺多选框 (88 / esplus)                                  │
│  ├── 指标多选框 (销售/取消/退货/运费/成本...)                  │
│  ├── 模式切换 (金额/数量/订单/占比)                            │
│  └── 图表类型 (折线图/饼图)                                    │
└────────────────────────────────────────────────────────────────┘
```

### 2.2 视图函数

**文件**: `backend/apps/visuals/views.py`

```python
@login_required
def index(request):
    """可视化主页面"""
    # 检查是否需要解锁
    required_tokens = SecurityPolicyManager.get_required_tokens('btn_unlock_visuals')
    if not required_tokens:
        request.session['visuals_unlocked'] = True
    
    is_unlocked = request.session.get('visuals_unlocked', False)
    
    context = {
        "is_unlocked": is_unlocked,
        "default_start": (date.today() - timedelta(days=30)).strftime('%Y-%m-%d'),
        "default_end": date.today().strftime('%Y-%m-%d'),
    }
    return render(request, 'visuals/index.html', context)
```

---

## 三、数据 API 详解

### 3.1 API 入口

**路由**: `GET /dashboard/sales/visuals/data/`

**参数**:
| 参数 | 类型 | 说明 |
|------|------|------|
| `start` | string | 起始日期 (YYYY-MM-DD) |
| `end` | string | 结束日期 (YYYY-MM-DD) |
| `stores[]` | array | 店铺列表 ['88', 'esplus'] |
| `type` | string | 图表类型 (line/pie) |
| `mode` | string | 数据模式 (Amount/Quantity/Order/Percentage) |
| `actions[]` | array | 选中的动作指标 |
| `ships[]` | array | 选中的运费指标 |
| `fees[]` | array | 选中的费用指标 |

**返回**:
```json
// 折线图
{
    "categories": ["2026-01-01", "2026-01-02", ...],
    "series": [
        {"name": "产品销售", "data": [1000, 1200, ...]},
        {"name": "订单取消", "data": [50, 30, ...]}
    ]
}

// 饼图
{
    "pie_data": [
        {"name": "净销售", "value": 50000, "percentage": 45.2, "details": {}},
        {"name": "净退货", "value": 5000, "percentage": 4.5, "details": {"订单取消": 2000, ...}}
    ]
}
```

### 3.2 指标映射表

**文件**: `backend/apps/visuals/views.py` L20-38

```python
# 动作指标映射 (UI 中文名 → 服务层列名)
ACTION_MAP = {
    "产品销售": "Sales",           # 正常销售
    "订单取消": "Cancel",          # 用户取消
    "无平台介入主动退货": "Return", # 客户主动退货
    "平台介入用户退货": "Request",  # 平台介入的退货
    "平台介入强制退货": "Case",     # 平台强制退款
    "第三方仅退款": "Dispute"       # 银行投诉
}

# 运费指标映射
SHIP_MAP = {
    "普通邮递": "Total_ShipRegular",   # 正常运费支出
    "邮费罚款": "Total_ShipUnder",     # 运费不足罚款
    "邮费超支": "Total_ShipOver",      # 运费超额退款
    "包退货邮费": "Total_ShipReturn"   # 退货运费
}

# 费用指标映射
FEE_MAP = {
    "产品成本": "Total_COGS",          # 产品采购成本
    "平台费用": "Total_PlatformFee"    # eBay 平台佣金
}
```

### 3.3 数据模式说明

| 模式 | 说明 | 数据来源列 |
|------|------|-----------|
| Amount | 金额 (美元) | `{Action}_Amount` |
| Quantity | 数量 (件) | `{Action}_Quantity` |
| Order | 订单数 | `{Action}_Order` |
| Percentage | 占比 (%) | 基于 Amount 计算 |

**占比计算逻辑**:
```python
if is_pct:
    # 以产品销售额为基准
    total_sales_base = df['Sales_Amount'].abs()
    series_data = ((vals.abs() / total_sales_base) * 100).round(1).tolist()
```

---

## 四、VisualService 核心逻辑

**文件**: `backend/core/services/visual_service.py`

### 4.1 主入口

```python
def load_and_aggregate(self, start_date, end_date, stores):
    """
    [主入口] 加载数据并聚合
    Returns: (Aggregated DataFrame, Debug SQL)
    """
    # 1. 构造 SQL 查询
    sql = """
        SELECT * FROM Data_Clean_Log 
        WHERE `order date` >= :start
          AND `order date` <= :end
          AND `seller` IN ('{store_str}')
    """
    df = self.db.read_df(sql, params)
    
    # 2. 预处理
    df = self._preprocess(df)
    
    # 3. 费用归类
    df = self._classify_fees(df)
    
    # 4. 成本计算
    df = self._calculate_cogs(df)
    
    # 5. 时间聚合
    df = self._aggregate_by_time(df, start_date, end_date)
    
    return df, sql
```

### 4.2 时间粒度自适应

```python
def _get_date_grain(self, start: date, end: date) -> str:
    """根据时间跨度自动决定聚合粒度"""
    delta = (end - start).days
    if delta <= 35:
        return 'D'   # 1个月内 → 按天
    elif delta <= 180:
        return 'W'   # 半年内 → 按周
    else:
        return 'ME'  # 半年以上 → 按月末
```

### 4.3 Action 映射

```python
# 订单动作代码 → 人类可读名称
ACTION_GROUPS = {
    'CA': 'Cancel',    # 取消
    'RE': 'Return',    # 退货 (无平台介入)
    'CC': 'Case',      # 客户投诉 (平台强制)
    'CR': 'Request',   # 退货申请 (平台介入)
    'PD': 'Dispute'    # 银行投诉
}

# 应用映射 (未匹配的默认为 'Sales')
df['ui_action'] = df['action'].str.upper().map(ACTION_GROUPS).fillna('Sales')
```

### 4.4 费用归类

```python
def _classify_fees(self, df):
    """将原始费用列归类为计算列"""
    
    # 1. 运费相关
    ship_map = {
        'shipping label-earning data': 'calc_ship_regular',  # 正常运费
        'shipping label-underpay': 'calc_ship_under',        # 运费罚款
        'shipping label-overpay': 'calc_ship_over',          # 运费超支退款
        'shipping label-return': 'calc_ship_return'          # 退货运费
    }
    for db_col, calc_col in ship_map.items():
        if db_col in df.columns:
            df[calc_col] = pd.to_numeric(df[db_col], errors='coerce').fillna(0).abs()
    
    # 2. 平台费用 (引用 ProfitAnalyzerBase 的定义)
    platform_fee_cols = [
        "Final Value Fee - fixed",
        "Final Value Fee - variable",
        "Regulatory operating fee",
        "International fee",
        ...
    ]
    valid_cols = [c.lower() for c in platform_fee_cols if c.lower() in df.columns]
    df['calc_platform_fee'] = df[valid_cols].sum(axis=1).abs()
    
    return df
```

### 4.5 成本计算 (COGS)

```python
def _vectorized_cogs_calc(self, df, sku_cost_map):
    """[高性能] 向量化计算每行总成本"""
    total_cogs = pd.Series(0.0, index=df.index)
    base_qty = pd.to_numeric(df['quantity'], errors='coerce').fillna(0)
    
    # 遍历 sku1 - sku10
    for i in range(1, 11):
        s_col = f'sku{i}'
        q_col = f'qty{i}'
        if s_col not in df.columns:
            continue
        
        # SKU → 单位成本
        current_skus = df[s_col].astype(str).str.strip().str.upper()
        unit_costs = current_skus.map(sku_cost_map).fillna(0.0)
        
        # 套内数量
        per_qtys = pd.to_numeric(df[q_col], errors='coerce').fillna(0)
        
        # 累加: 单位成本 × 套内数量 × 订单数量
        line_cost = unit_costs * per_qtys * base_qty
        total_cogs += line_cost
    
    return total_cogs
```

**成本计算公式**:
```
行成本 = Σ (SKU单位成本 × 套内数量 × 订单数量)

例如:
订单包含 SKU001*2 + SKU002*1，订单数量=3
SKU001 成本 = $10，SKU002 成本 = $5
行成本 = ($10 × 2 × 3) + ($5 × 1 × 3) = $60 + $15 = $75
```

### 4.6 时间聚合

```python
def _aggregate_by_time(self, df, start_date, end_date):
    """按时间粒度聚合数据"""
    
    # 1. 设定聚合规则
    agg_rules = {
        'revenue': 'sum',           # 金额
        'calc_real_qty': 'sum',     # 数量
        'order number': 'nunique',  # 订单数 (去重计数)
        'calc_cogs': 'sum',         # 成本
        'calc_platform_fee': 'sum', # 平台费
        'calc_ship_regular': 'sum', # 正常运费
        'calc_ship_under': 'sum',   # 罚款
        'calc_ship_over': 'sum',    # 超支退款
        'calc_ship_return': 'sum'   # 退货运费
    }
    
    # 2. 确定时间粒度
    grain = self._get_date_grain(start_date, end_date)
    
    # 3. 按 [时间, Action] 分组聚合
    grouped = df.groupby([
        pd.Grouper(key='dt', freq=grain),  # 时间分组
        'ui_action'                        # 动作分组
    ]).agg(agg_rules).reset_index()
    
    # 4. Pivot: 行转列
    pivot_df = grouped.pivot(
        index='dt', 
        columns='ui_action', 
        values=list(agg_rules.keys())
    )
    
    # 5. 展平列名: ('revenue', 'Sales') → 'Sales_Amount'
    pivot_df.columns = [f"{col[1]}_{col[0]}" for col in pivot_df.columns]
    
    # 6. 计算总量列
    total_agg = df.groupby(pd.Grouper(key='dt', freq=grain)).agg(agg_rules)
    total_agg.columns = [f"Total_{c}" for c in total_agg.columns]
    
    # 7. 合并
    final_df = pd.concat([pivot_df, total_agg], axis=1).fillna(0)
    
    # 8. 重命名为 UI 友好格式
    final_df = final_df.rename(columns={
        'revenue': 'Amount',
        'calc_real_qty': 'Quantity',
        'order number': 'Order',
        'calc_cogs': 'COGS',
        'calc_platform_fee': 'PlatformFee',
        'calc_ship_regular': 'ShipRegular',
        'calc_ship_under': 'ShipUnder',
        'calc_ship_over': 'ShipOver',
        'calc_ship_return': 'ShipReturn'
    })
    
    # 9. 添加日期字符串列
    final_df['DateStr'] = final_df.index.strftime('%Y-%m-%d')
    
    return final_df
```

---

## 五、饼图计算逻辑

### 5.1 净利润分解公式

```
净销售 = 产品销售 - 净退货 - 物流费用 - 产品成本 - 平台佣金

其中:
- 净退货 = |取消金额| + |退货金额| + |投诉金额|
- 物流费用 = 普通邮递 + 邮费罚款 - 邮费超支 + 包退货邮费
```

### 5.2 饼图计算函数

**文件**: `backend/apps/visuals/views.py` L196-308

```python
def calculate_pie_data(df):
    """计算饼图数据 (净利润分解)"""
    
    # 1. 聚合为标量
    sums = df.sum(numeric_only=True)
    
    # 2. 获取原始值
    v_sales = sums.get('Sales_Amount', 0)  # 产品销售 (+)
    
    # 3. 计算净退货 (取绝对值)
    ret_cols = ['Cancel_Amount', 'Return_Amount', 'Request_Amount', 
                'Case_Amount', 'Dispute_Amount']
    v_ret_mag = sum(abs(sums.get(c, 0)) for c in ret_cols)
    
    # 4. 计算物流费用
    v_ship_val = (abs(sums.get('Total_ShipRegular', 0)) +  # 普通运费
                  abs(sums.get('Total_ShipUnder', 0)) -    # 罚款
                  abs(sums.get('Total_ShipOver', 0)) +     # 超支退款
                  abs(sums.get('Total_ShipReturn', 0)))    # 退货运费
    
    # 5. 获取成本和费用
    v_cogs = abs(sums.get('Total_COGS', 0))
    v_fees = abs(sums.get('Total_PlatformFee', 0))
    
    # 6. 计算净销售
    v_net_sales = v_sales - v_ret_mag - v_ship_val - v_cogs - v_fees
    
    # 7. 构建饼图数据
    denom = v_sales if v_sales != 0 else 1.0  # 避免除零
    
    pie_data = [
        {
            "name": "净销售",
            "value": round(v_net_sales, 2),
            "percentage": round(v_net_sales / denom * 100, 1),
            "details": {}
        },
        {
            "name": "净退货",
            "value": round(v_ret_mag, 2),
            "percentage": round(v_ret_mag / denom * 100, 1),
            "details": {
                "订单取消": round(abs(sums.get('Cancel_Amount', 0)), 2),
                "无平台介入主动退货": round(abs(sums.get('Return_Amount', 0)), 2),
                # ...
            }
        },
        {
            "name": "物流费用",
            "value": round(v_ship_val, 2),
            "percentage": round(v_ship_val / denom * 100, 1),
            "details": {
                "普通邮递": round(abs(sums.get('Total_ShipRegular', 0)), 2),
                "邮费罚款": round(abs(sums.get('Total_ShipUnder', 0)), 2),
                "邮费超支": round(abs(sums.get('Total_ShipOver', 0)), 2),
                "包退货邮费": round(abs(sums.get('Total_ShipReturn', 0)), 2)
            }
        },
        {
            "name": "产品成本",
            "value": round(v_cogs, 2),
            "percentage": round(v_cogs / denom * 100, 1),
            "details": {}
        },
        {
            "name": "平台佣金",
            "value": round(v_fees, 2),
            "percentage": round(v_fees / denom * 100, 1),
            "details": {}
        }
    ]
    
    return {"pie_data": pie_data}
```

---

## 六、数据流图

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           可视化数据流                                        │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                      Data_Clean_Log 表                                  │ │
│  │  (由 ETL 模块写入的清洗后交易数据)                                       │ │
│  │  字段: order date, seller, action, quantity, revenue, sku1~sku10, ...   │ │
│  └───────────────────────────────────┬─────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                      VisualService.load_and_aggregate()                 │ │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Step 1: SQL 查询                                                │   │ │
│  │  │  SELECT * FROM Data_Clean_Log                                    │   │ │
│  │  │  WHERE order_date BETWEEN :start AND :end                        │   │ │
│  │  │    AND seller IN (:stores)                                       │   │ │
│  │  └──────────────────────────────────────────────────────────────────┘   │ │
│  │                                      │                                   │ │
│  │                                      ▼                                   │ │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Step 2: 预处理                                                  │   │ │
│  │  │  - 列名归一化 (lowercase)                                        │   │ │
│  │  │  - 数值类型转换 (quantity, revenue)                              │   │ │
│  │  │  - Action 映射 (CA/RE/CC/CR/PD → Cancel/Return/...)             │   │ │
│  │  └──────────────────────────────────────────────────────────────────┘   │ │
│  │                                      │                                   │ │
│  │                                      ▼                                   │ │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Step 3: 费用归类                                                │   │ │
│  │  │  - 运费: shipping label → calc_ship_*                           │   │ │
│  │  │  - 平台费: Final Value Fee + Regulatory + ... → calc_platform   │   │ │
│  │  └──────────────────────────────────────────────────────────────────┘   │ │
│  │                                      │                                   │ │
│  │                                      ▼                                   │ │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Step 4: COGS 计算                                               │   │ │
│  │  │  ┌────────────────┐        ┌────────────────────────────────┐    │   │ │
│  │  │  │  Data_COGS     │   →    │  向量化成本计算                 │    │   │ │
│  │  │  │  (SKU → Cost)  │        │  Σ(unit_cost × per_qty × qty)  │    │   │ │
│  │  │  └────────────────┘        └────────────────────────────────┘    │   │ │
│  │  └──────────────────────────────────────────────────────────────────┘   │ │
│  │                                      │                                   │ │
│  │                                      ▼                                   │ │
│  │  ┌──────────────────────────────────────────────────────────────────┐   │ │
│  │  │  Step 5: 时间聚合                                                │   │ │
│  │  │  - 自动选择粒度 (D/W/ME)                                         │   │ │
│  │  │  - GroupBy + Pivot (时间 × Action)                               │   │ │
│  │  │  - 列名重命名 (Sales_Amount, Cancel_Quantity, ...)               │   │ │
│  │  └──────────────────────────────────────────────────────────────────┘   │ │
│  └───────────────────────────────────┬─────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                      Views: get_chart_data()                            │ │
│  │  - 根据用户选择筛选列                                                    │ │
│  │  - 格式化为前端需要的 JSON 结构                                          │ │
│  │  - 折线图: {categories, series}                                         │ │
│  │  - 饼图: {pie_data}                                                     │ │
│  └───────────────────────────────────┬─────────────────────────────────────┘ │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                      前端 ECharts 渲染                                   │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 七、输出列名映射

### 7.1 完整列名对照表

| 服务层列名 | UI 显示名称 | 数据来源 |
|-----------|------------|----------|
| `Sales_Amount` | 产品销售 (金额) | revenue (action=SA) |
| `Sales_Quantity` | 产品销售 (数量) | quantity (action=SA) |
| `Sales_Order` | 产品销售 (订单数) | order number (action=SA) |
| `Cancel_Amount` | 订单取消 (金额) | revenue (action=CA) |
| `Return_Amount` | 无平台介入主动退货 | revenue (action=RE) |
| `Request_Amount` | 平台介入用户退货 | revenue (action=CR) |
| `Case_Amount` | 平台介入强制退货 | revenue (action=CC) |
| `Dispute_Amount` | 第三方仅退款 | revenue (action=PD) |
| `Total_ShipRegular` | 普通邮递 | shipping label-earning data |
| `Total_ShipUnder` | 邮费罚款 | shipping label-underpay |
| `Total_ShipOver` | 邮费超支 | shipping label-overpay |
| `Total_ShipReturn` | 包退货邮费 | shipping label-return |
| `Total_COGS` | 产品成本 | 计算值 (基于 Data_COGS) |
| `Total_PlatformFee` | 平台费用 | sum(Final Value Fee + ...) |

---

## 八、安全机制

### 8.1 解锁验证

```python
# 检查是否需要密码解锁
required_tokens = SecurityPolicyManager.get_required_tokens('btn_unlock_visuals')

# 如果配置了密码策略，需要验证
if required_tokens:
    passed, reason = SecurityPolicyManager.verify_action_request(
        request, 
        'btn_unlock_visuals'
    )
    if not passed:
        return JsonResponse({'success': False, 'message': reason}, status=403)
    
    # 验证通过，设置 session
    request.session['visuals_unlocked'] = True
```

### 8.2 数据访问控制

```python
@login_required
def get_chart_data(request):
    # 检查是否已解锁
    if not request.session.get('visuals_unlocked', False):
        if SecurityPolicyManager.get_required_tokens('btn_unlock_visuals'):
            return JsonResponse({"error": "未解锁"}, status=403)
```

---

## 九、URL 路由表

| 路由 | 视图函数 | 说明 |
|------|----------|------|
| `/dashboard/sales/visuals/` | `index` | 可视化主页面 |
| `/dashboard/sales/visuals/unlock/` | `unlock` | 解锁验证 (POST) |
| `/dashboard/sales/visuals/data/` | `get_chart_data` | 数据 API (GET) |

---

## 十、店铺映射

```python
# UI 简称 → 数据库值
STORE_MAP = {
    "88": "esparts88",
    "esplus": "espartsplus"
}
```

---

## 十一、性能考量

### 11.1 向量化计算

```python
# 避免逐行循环，使用 Pandas 向量化操作
df['calc_cogs'] = self._vectorized_cogs_calc(df, sku_cost_map)

# 而非:
# for idx, row in df.iterrows():
#     df.at[idx, 'calc_cogs'] = calculate_row_cogs(row)
```

### 11.2 时间粒度自适应

```python
# 根据查询时间跨度自动调整聚合粒度
# 避免大时间范围产生过多数据点
if delta <= 35:
    grain = 'D'   # 35 天内按天
elif delta <= 180:
    grain = 'W'   # 半年内按周
else:
    grain = 'ME'  # 超过半年按月
```

### 11.3 前端筛选

```python
# 只返回用户选择的指标列，减少数据传输
target_inputs = input_actions + input_ships + input_fees
for ui in target_inputs:
    col = get_df_col(ui)
    if col and col in df.columns:
        series_list.append({
            "name": ui,
            "data": df[col].round(2).tolist()
        })
```

---

**文档结束**
