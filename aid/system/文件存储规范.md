# æ–‡ä»¶å­˜å‚¨è§„èŒƒ v1.1

> **Purpose**: æ­¤æ–‡ä»¶æ ‡å‡†åŒ–äº†ç³»ç»Ÿå†…æ‰€æœ‰æ–‡ä»¶ï¼ˆInvoice, Receipts, etc.ï¼‰çš„å­˜å‚¨è·¯å¾„ã€å‘½åè§„åˆ™å’Œç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ã€‚
> **AI Attention**: å¤„ç†æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½æ—¶ï¼Œ**å¿…é¡»** ä¸¥æ ¼éµå®ˆæ­¤è·¯å¾„å’Œå‘½åè§„èŒƒã€‚ä¸¥ç¦éšæ„åˆ›å»ºç›®å½•æˆ–ä½¿ç”¨éæ ‡å‡†æ–‡ä»¶åã€‚
> **Constraints**: `HARD` - æ–‡ä»¶ç³»ç»Ÿç»“æ„å¿…é¡»ç»Ÿä¸€ã€‚
> **Related Files**: 
> - `aid/safety/æµç¨‹.md`: ç”Ÿæˆæ–‡ä»¶çš„ä¸šåŠ¡æµç¨‹ã€‚
> - `backend/common/settings.py`: å®šä¹‰äº†ç›¸å…³çš„è·¯å¾„å¸¸é‡ã€‚



> **æœ€åæ›´æ–°**: 2026-01-09
> **é€‚ç”¨èŒƒå›´**: æ‰€æœ‰ä¸šåŠ¡æ¨¡å—çš„æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½
> **ä¸»ç›®å½•**: `{PROJECT_ROOT}/data/records/`

---

## ä¸€ã€ç›®å½•ç»“æ„æ€»è§ˆ

```
data/records/
â”œâ”€â”€ purchase/                    # é‡‡è´­æ¿å—
â”‚   â”œâ”€â”€ po/                      # è®¢å•ç®¡ç†ï¼ˆå‚å•†è´¦å•ï¼‰
â”‚   â”‚   â””â”€â”€ {YYYY}/              # æŒ‰å¹´ä»½åˆ†ç»„
â”‚   â”‚       â””â”€â”€ {supplier_code}/ # æŒ‰ä¾›åº”å•†ä»£ç åˆ†ç»„
â”‚   â”‚           â””â”€â”€ {æ–‡ä»¶}
â”‚   â”œâ”€â”€ send/                    # å‘è´§å•ç®¡ç†ï¼ˆç‰©æµè´¦å•ï¼‰
â”‚   â”‚   â””â”€â”€ {YYYY}/              # æŒ‰å¹´ä»½åˆ†ç»„
â”‚   â”‚       â””â”€â”€ {æ–‡ä»¶}
â”‚   â””â”€â”€ receive/                 # å…¥åº“ç®¡ç†ï¼ˆå…¥åº“å‡­è¯ï¼‰
â”‚       â””â”€â”€ {YYYY}/              # æŒ‰å¹´ä»½åˆ†ç»„
â”‚           â””â”€â”€ {æ–‡ä»¶}
â”‚
â””â”€â”€ finance/                     # è´¢åŠ¡æ¿å—
    â”œâ”€â”€ logistic/                # ç‰©æµä»˜æ¬¾å‡­è¯
    â”‚   â””â”€â”€ {YYYY}/              # æŒ‰å¹´ä»½åˆ†ç»„
    â”‚       â””â”€â”€ {pmt_no}/        # æŒ‰ä»˜æ¬¾æ‰¹æ¬¡å·åˆ†ç»„
    â”‚           â””â”€â”€ {æ–‡ä»¶}
    â”‚
    â””â”€â”€ po/                      # [é¢„ç•™] POä»˜æ¬¾ï¼ˆé‡‡è´­è®¢å•ä»˜æ¬¾ï¼‰
        â””â”€â”€ {YYYY}/              # æŒ‰å¹´ä»½åˆ†ç»„
            â””â”€â”€ {pmt_no}/        # æŒ‰ä»˜æ¬¾æ‰¹æ¬¡å·åˆ†ç»„
                â””â”€â”€ {æ–‡ä»¶}
```

---

## äºŒã€å‘½åè§„èŒƒ

### 2.1 é€šç”¨è§„åˆ™

| è¦ç´  | æ ¼å¼ | ç¤ºä¾‹ |
|------|------|------|
| å¹´ä»½ (YYYY) | 4ä½æ•°å­— | `2026` |
| æ—¥æœŸ (YYYYMMDD) | 8ä½æ•°å­—ï¼Œ**æ— è¿å­—ç¬¦** | `20260104` |
| ç‰ˆæœ¬å· | `_V##` (2ä½æ•°å­—) | `_V01`, `_V02` |
| æ‰©å±•å | å°å†™ | `.pdf`, `.jpg`, `.xlsx` |

### 2.2 å„æ¨¡å—æ–‡ä»¶å‘½å

#### ğŸ“¦ è®¢å•ç®¡ç† (PO) - å‚å•†è´¦å•

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| **ç›®å½•** | `data/records/purchase/po/{YYYY}/{supplier_code}/` |
| **æ–‡ä»¶å** | `{po_num}_invoice_V##.{ext}` |
| **ç¤ºä¾‹** | `data/records/purchase/po/2026/XX/XX20260104S01_invoice_V01.pdf` |

**è¯´æ˜**:
- `YYYY`: è®¢å•å¹´ä»½ï¼ˆä» `po_num` ä¸­çš„æ—¥æœŸéƒ¨åˆ†è§£æï¼Œå¦‚ `XX20260104S01` â†’ 2026ï¼‰
- `supplier_code`: è®¢å•å·å‰ä¸¤ä½ï¼ˆå¦‚ `XX`ï¼‰
- `po_num`: å®Œæ•´è®¢å•å·ï¼ˆ**å»é™¤è¿å­—ç¬¦**ï¼Œå¦‚ `XX20260104S01`ï¼‰

---

#### ğŸšš å‘è´§å•ç®¡ç† (Send) - ç‰©æµè´¦å•

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| **ç›®å½•** | `data/records/purchase/send/{YYYY}/` |
| **æ–‡ä»¶å** | `{logistic_num}_invoice_V##.{ext}` |
| **ç¤ºä¾‹** | `data/records/purchase/send/2026/L260104001_invoice_V01.pdf` |

**è¯´æ˜**:
- `YYYY`: å‘è´§å¹´ä»½ï¼ˆä» `date_sent` æˆ– `logistic_num` è§£æï¼‰
- `logistic_num`: ç‰©æµå•å·

---

#### ğŸ“¥ å…¥åº“ç®¡ç† (Receive) - å…¥åº“å‡­è¯

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| **ç›®å½•** | `data/records/purchase/receive/{YYYY}/` |
| **æ–‡ä»¶å** | `{receive_date}_{logistic_num}_V##.{ext}` |
| **ç¤ºä¾‹** | `data/records/purchase/receive/2026/20260104_L260104001_V01.pdf` |

**è¯´æ˜**:
- `YYYY`: å…¥åº“å¹´ä»½
- `receive_date`: å…¥åº“æ—¥æœŸ (YYYYMMDDï¼Œæ— è¿å­—ç¬¦)
- `logistic_num`: ç‰©æµå•å·

---

#### ğŸ’° ç‰©æµä»˜æ¬¾ (Logistic Payment) - ä»˜æ¬¾å‡­è¯

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| **ç›®å½•** | `data/records/finance/logistic/{YYYY}/{pmt_no}/` |
| **æ–‡ä»¶å** | `{pmt_no}_V##.{ext}` |
| **ç¤ºä¾‹** | `data/records/finance/logistic/2026/20260104_S01/20260104_S01_V01.pdf` |

**è¯´æ˜**:
- `YYYY`: ä»˜æ¬¾å¹´ä»½
- `pmt_no`: ä»˜æ¬¾æ‰¹æ¬¡å·ï¼ˆæ ¼å¼ `YYYYMMDD_S##`ï¼Œ**æ— è¿å­—ç¬¦**ï¼‰
- æ¯ä¸ªä»˜æ¬¾æ‰¹æ¬¡ç‹¬ç«‹ç›®å½•ï¼Œä¾¿äºç®¡ç†å¤šä¸ªå‡­è¯æ–‡ä»¶

---

#### ğŸ§¾ [é¢„ç•™] POä»˜æ¬¾ (PO Payment) - é‡‡è´­è®¢å•ä»˜æ¬¾å‡­è¯

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| **ç›®å½•** | `data/records/finance/po/{YYYY}/{pmt_no}/` |
| **æ–‡ä»¶å** | `{pmt_no}_V##.{ext}` |
| **ç¤ºä¾‹** | `data/records/finance/po/2026/20260104_P01/20260104_P01_V01.pdf` |

**è¯´æ˜**:
- `YYYY`: ä»˜æ¬¾å¹´ä»½
- `pmt_no`: ä»˜æ¬¾æ‰¹æ¬¡å·ï¼ˆæ ¼å¼ `YYYYMMDD_P##`ï¼ŒP è¡¨ç¤º PO Paymentï¼‰

---

#### ğŸ’³ ä¾›åº”å•†é¢„ä»˜æ¬¾ (Supplier Prepayment) - é¢„ä»˜æ¬¾å‡­è¯

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| **ç›®å½•** | `data/records/finance/prepay/{YYYY}/{tran_num}/` |
| **æ–‡ä»¶å** | `{tran_num}_V##.{ext}` |
| **ç¤ºä¾‹** | `data/records/finance/prepay/2026/XX_20260104_in_01/XX_20260104_in_01_V01.pdf` |

**è¯´æ˜**:
- `YYYY`: é¢„ä»˜æ¬¾å¹´ä»½ï¼ˆä» `tran_date` è§£æï¼‰
- `tran_num`: æµæ°´å·ï¼ˆæ ¼å¼ `{supplier_code}_{YYYYMMDD}_in_##`ï¼‰
- æ¯ä¸ªé¢„ä»˜æ¬¾è®°å½•ç‹¬ç«‹ç›®å½•ï¼Œä¾¿äºç®¡ç†å¤šä¸ªå‡­è¯æ–‡ä»¶

---

#### ğŸ§ å®šé‡‘ä»˜æ¬¾ (Deposit Payment) - ä»˜æ¬¾å‡­è¯

| é¡¹ç›® | è§„èŒƒ |
|------|------|
| **ç›®å½•** | `data/records/finance/deposit/{YYYY}/{pmt_no}/` |
| **æ–‡ä»¶å** | `{pmt_no}_V##.{ext}` |
| **ç¤ºä¾‹** | `data/records/finance/deposit/2026/DEP20260108-001/DEP20260108-001_V01.pdf` |

**è¯´æ˜**:
- `YYYY`: ä»˜æ¬¾å¹´ä»½
- `pmt_no`: ä»˜æ¬¾æ‰¹æ¬¡å·ï¼ˆæ ¼å¼ `DEP{YYYYMMDD}-###`ï¼‰

---


## ä¸‰ã€ç‰ˆæœ¬æ§åˆ¶è§„åˆ™

1. **é¦–æ¬¡ä¸Šä¼ **: ç‰ˆæœ¬å·ä¸º `V01`
2. **åç»­ä¸Šä¼ **: è‡ªåŠ¨é€’å¢ (`V02`, `V03`...)
3. **ç‰ˆæœ¬æ£€æµ‹**: æ‰«æç›®å½•ä¸­å·²æœ‰æ–‡ä»¶ï¼Œå–æœ€å¤§ç‰ˆæœ¬å· + 1
4. **ä¿ç•™å†å²**: ä¸è¦†ç›–æ—§ç‰ˆæœ¬ï¼Œæ‰€æœ‰ç‰ˆæœ¬å‡ä¿ç•™

---

## å››ã€é…ç½®å¸¸é‡

```python
# backend/common/settings.py

from pathlib import Path

# æ–‡ä»¶å­˜å‚¨æ ¹ç›®å½•
RECORDS_DIR = BASE_DIR.parent / 'data' / 'records'

# å„æ¨¡å—å­ç›®å½•
PO_INVOICE_DIR = RECORDS_DIR / 'purchase' / 'po'
SEND_INVOICE_DIR = RECORDS_DIR / 'purchase' / 'send'
RECEIVE_FILE_DIR = RECORDS_DIR / 'purchase' / 'receive'
LOGISTIC_PAYMENT_DIR = RECORDS_DIR / 'finance' / 'logistic'
PO_PAYMENT_DIR = RECORDS_DIR / 'finance' / 'po'  # [é¢„ç•™]

# æ”¯æŒçš„æ–‡ä»¶æ‰©å±•å
ALLOWED_FILE_EXTENSIONS = [
    '.pdf', '.jpg', '.jpeg', '.png', '.gif', 
    '.heic', '.heif', '.xls', '.xlsx', 
    '.doc', '.docx', '.csv', '.zip', '.rar'
]

# æœ€å¤§æ–‡ä»¶å¤§å° (50MB)
MAX_UPLOAD_SIZE_MB = 50
```

---

## äº”ã€å®‰å…¨çº¦æŸ

1. **è·¯å¾„éå†é˜²æŠ¤**: æ–‡ä»¶åä¸å…è®¸åŒ…å« `..` æˆ– `/`
2. **ç™½åå•æ‰©å±•å**: ä»…å…è®¸ä¸Šè¿°åˆ—è¡¨ä¸­çš„æ‰©å±•å
3. **æ–‡ä»¶åæ ¡éªŒ**: å¿…é¡»ä»¥é¢„æœŸå‰ç¼€å¼€å¤´
4. **æœ€å¤§æ–‡ä»¶å¤§å°**: 50MB

---

## å…­ã€è¿ç§»è®°å½•

| æ—¥æœŸ | æ“ä½œ |
|------|------|
| 2026-01-04 | åˆå§‹è¿ç§»ï¼šå°†æ—§ç›®å½•æ–‡ä»¶è¿ç§»è‡³ `data/records/` |

### å·²è¿ç§»æ–‡ä»¶æ¸…å•

```
data/records/purchase/po/2025/XX/XX20251227S01_invoice_V01.pdf
data/records/purchase/po/2026/XX/XX20260102S01_invoice_V01.png
data/records/purchase/po/2026/XX/XX20260105S01_invoice_V01.pdf
data/records/purchase/send/2026/TEST1_invoice_V01.pdf
data/records/purchase/receive/2026/20260131_TEST1_V01.pdf
```

### å·²åˆ é™¤çš„æ—§ç›®å½•

- `data/po_invoices/`
- `data/logistic/`
- `data/receiving/`
- `storage/finance/`
