---
name: collaboration
description: 跨团队协作 SOP。Use when 涉及多角色交接、依赖管理、冲突升级或跨团队协同。
---

# 跨团队协作 (Cross-Team Collaboration)

---

## 1. 协作原则

| 原则 | 说明 |
|------|------|
| **接口先行** | 协作双方先约定接口 (DTO/API/Props)，再各自实现 |
| **依赖明确** | 每个任务的前置依赖必须写清楚 |
| **交接记录** | 每次交接都有记录（时间、给谁、给了什么） |
| **问题上报** | 协作冲突 30 分钟解决不了 → 上报总工 |

---

## 2. 常见协作场景

- **数据 → 后端**：Schema/Migration 先行 → 交付表结构+字段+索引/约束 → 后端创建 Entity/Repository/Service
- **后端 → 前端**：DTO/Controller 先行 → 交付 API 路径+请求响应+错误码 → 前端创建 Client/Hooks/组件
- **安全 → 后端**：权限矩阵先行 → 交付哪些 API 需要什么权限+审计日志要求 → 后端添加注解

---

## 3. 交接协议

交接记录格式 → `core/templates/handoff-record-template.md`

接收方验收：确认交付物完整、接口约定清晰、能基于交付物开始工作，有问题立即反馈。

---

## 4. 内部讨论

| 场景 | 处理 |
|------|------|
| 架构决策 | 列出方案 → 分析优缺 → 选最优 |
| 技术分歧 | 各自陈述 → 总工裁决 |
| 风险发现 | 评估影响 → 报告总工 |
| 需求疑问 | 收集问题 → 总工反馈 PM |

讨论结论格式 → `core/templates/discussion-template.md`

---

## 5. 依赖管理

| 类型 | 说明 | 处理 |
|------|------|------|
| **硬依赖** | A 必须在 B 前完成 | 严格排序 |
| **软依赖** | A 的接口约定后 B 可并行 | 约定接口 → 并行 |
| **无依赖** | A 和 B 完全独立 | 并行执行 |

典型顺序：Schema → Entity → API → 前端；安全约束并行于业务实现。

---

## 6. 冲突升级

工程师分歧 → 自行讨论（≤5 分钟）→ 未解决则上报总工 → 总工裁决 → 涉及需求变更则通知 PM。

**记录要求**:
- 技术分歧升级到 CTO 后，CTO 决策必须写入 `discussion-template.md`
- 决策记录存入 `data/plans/` 供后续参考
- 重复出现的分歧模式 → 写入 PROJECT-MEMORY 作为团队约定

---

## 7. 变更传播协议

> **组织层面：谁改了什么需要通知谁。技术追踪步骤见 `core/rules/common.md` §6。**

| 变更源 | 必须同步的下游角色 |
|--------|----------------|
| DB Schema | 后端工程师（Entity/Mapper） |
| 后端 DTO/Controller | 前端工程师（Types/API Client） |
| API 路径修改 | 前端 + Nginx + 后端 |
| 权限矩阵修改 | 后端安全 + 前端 Guard |
| i18n Key 修改 | 所有语言文件负责人 |
| 删除/重命名文件 | 所有引用者 |

工程师完成后在交接记录中标注：`"需要 [XXX 工程师] 同步 [YYY 文件]"` 或 `"无下游影响"`。

CTO 收到交付后：检查所有下游已安排同步，确认全链路完成后才标记任务为完成。

---

## 8. 跨域协调协议

> **全栈任务时，CTO 必须指定"主域"和"协作域"，明确跨域执行规则。**

### 8.1 域指定

| 字段 | 说明 |
|------|------|
| 主域 | 任务核心变更所在域（决定执行顺序的起点） |
| 协作域 | 需要配合的其他域 |

CTO 在任务分配时标注：`主域: {Service} | 协作域: {Product}`

### 8.2 跨域依赖强制顺序

```
Schema → Entity → API Contract → Frontend
```

并行条件：API Contract 已定义 + 双方签收接口协议。

### 8.3 跨域完成条件

- 所有域的完工报告已提交
- CTO 执行跨域整合验证（`chief-engineer.md` §5.5）
- 接口一致性确认（DTO ↔ TypeScript types）

---

## 9. 与全局工作流的关系

本文件定义工程师之间的协作规则。角色之间（PM↔CTO↔QA）的交接格式在 `workflows/build.md` 定义。

---

*Version: 3.1.0 — 新增 §6 冲突记录要求 + §8 跨域协调协议*
*Updated: 2026-02-19*
