# Refactor Equivalence Matrix（模板）

任务: {task}
来源 Spec: {spec}
审计人: {name}

## 1) 覆盖声明
- [ ] 原实现入口与主链路已覆盖
- [ ] 异常链路已覆盖
- [ ] 副作用链路已覆盖（日志/权限/事件/缓存）
- [ ] UNKNOWN 清单已列出并处理策略明确

## 2) 等价性矩阵（旧 vs 新）

| 场景ID | 输入 | 旧实现行为 | 新实现行为 | 等价? | 证据（文件/函数/测试） |
|---|---|---|---|---|---|
| EQ-001 | {input} | {old} | {new} | ✅/❌ | {ref} |

## 3) 非功能等价

| 类别 | 旧实现 | 新实现 | 结果 |
|---|---|---|---|
| 权限/鉴权 | {old} | {new} | ✅/❌ |
| 审计日志 | {old} | {new} | ✅/❌ |
| 性能（关键路径） | {old} | {new} | ✅/❌ |
| 错误语义（码/文案） | {old} | {new} | ✅/❌ |

## 4) 老架构弱点与修复映射（必须）

| GAP-ID | 老架构问题 | 分类(性能/安全/设计) | 新架构修复方案 | 证据 |
|---|---|---|---|---|
| G-001 | {gap} | {type} | {fix} | {ref} |

## 5) UNKNOWN 清单

| ID | 描述 | 风险 | 处理方式 | 状态 |
|---|---|---|---|---|
| U-001 | {unknown} | 低/中/高 | 回源/确认/测试 | open/closed |

## 6) 结论
- [ ] 可进入 QA
- [ ] 需返工（原因：{...}）
