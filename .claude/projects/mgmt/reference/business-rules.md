# MGMT ERP — 业务规则

> **项目特定的业务逻辑, 不属于泛化工程规范。**

---

## 1. FIFO 成本追踪

| 规则 | 说明 |
|------|------|
| **唯一成本方法** | FIFO (先进先出) — 不支持 LIFO/加权平均 |
| **层 (Layer) 模型** | 每次入库创建一个 Layer (成本+数量) |
| **消耗顺序** | 出库时消耗最早的未消耗 Layer |
| **精度** | 成本 `DECIMAL(12,5)`, 数量 `INT` |
| **生产基准** | 244 INIT layers, 351 total layers |

---

## 2. 安全等级

| 等级 | 验证要求 | 操作类型 |
|------|----------|----------|
| **L1** | Bearer Token | 查询 (GET) |
| **L2** | Token + 密码确认 | 修改 (POST/PUT/DELETE) |
| **L3** | Token + 安全码 | 运维级 (备份/批量/迁移) |
| **L4** | Token + 系统码 | 核弹级 (清库/权限重配) |

---

## 3. 采购状态机

```
起草 → 待审批 → 已批准 → 已发货 → 已收货 → 已完成
                    ↓
                  已拒绝
        ↓ (任何阶段)
      已取消
```

---

## 4. VMA 业务规则

| 规则 | 说明 |
|------|------|
| **培训合规** | 每个 SOP 版本变更需要重新培训所有相关员工 |
| **Demo 库存** | P-Valve 和 Delivery System 有独立的 Demo 跟踪 |
| **临床案例** | 每个临床案例关联 P-Valve + Delivery System 各 1 unit |
| **培训路线图** | 新员工按入职日期之前的 SOP 基线培训 |
| **多岗位** | 员工↔岗位 多对多关系 |

---

## 5. 数据精度要求

| 字段类型 | 精度 | 示例 |
|----------|------|------|
| 金额 | `DECIMAL(12,2)` | $1,234,567.89 |
| 成本/费率 | `DECIMAL(12,5)` | $0.12345 |
| 数量 | `INT` | 50 |
| 百分比 | `DECIMAL(5,2)` | 99.99% |

---

## 6. 太平洋时区铁律

全项目所有日期/时间操作强制使用 `America/Los_Angeles`:

- 后端日期字符串必须加 `T12:00:00.000Z` 防跨天
- 前端显示对齐 PST/PDT
- 数据库存储 UTC, 应用层转换

---

*MGMT ERP Project Spec — Last Updated: 2026-02-11*
