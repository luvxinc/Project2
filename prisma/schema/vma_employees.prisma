// ================================
// VMA Employee & Department Models
// VMA 员工与部门职责管理
// ================================

/// VMA 部门职责定义 - 主键由 (部门码, 职责) 组成
model VmaDepartment {
  id              String   @id @default(uuid())
  code            String   // 部门码
  name            String   // 部门名称
  duties          String   // 职责描述 (必填)
  sopTrainingReq  String?  @map("sop_training_req")
  isActive        Boolean  @default(true) @map("is_active")
  deletedAt       DateTime? @map("deleted_at")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  sopRequirements     VmaDutySopRequirement[]
  employeeAssignments VmaEmployeeDepartment[]
  sopHistory          VmaDutySopHistory[]

  @@unique([code, duties])
  @@index([code])
  @@map("vma_departments")
}

/// VMA 员工记录
model VmaEmployee {
  id              String            @id @default(uuid())
  employeeNo      String            @unique @map("employee_no")
  lastName        String            @map("last_name")
  firstName       String            @map("first_name")
  hireDate        DateTime          @map("hire_date")
  terminationDate DateTime?         @map("termination_date")
  status          VmaEmployeeStatus @default(ACTIVE)
  deletedAt       DateTime?         @map("deleted_at")
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  departmentAssignments VmaEmployeeDepartment[]

  @@index([status])
  @@index([employeeNo])
  @@map("vma_employees")
}

enum VmaEmployeeStatus {
  ACTIVE
  INACTIVE
}

/// VMA 员工-部门分配历史 (显式关联表，带时间追踪)
model VmaEmployeeDepartment {
  id           String    @id @default(uuid())
  employeeId   String    @map("employee_id")
  departmentId String    @map("department_id")
  assignedAt   DateTime  @map("assigned_at")
  removedAt    DateTime? @map("removed_at")
  createdAt    DateTime  @default(now()) @map("created_at")

  employee   VmaEmployee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  department VmaDepartment @relation(fields: [departmentId], references: [id], onDelete: Restrict)

  @@index([employeeId])
  @@index([departmentId])
  @@map("vma_employee_departments")
}

/// VMA 职责 SOP 需求变更历史
model VmaDutySopHistory {
  id           String   @id @default(uuid())
  departmentId String   @map("department_id")
  changeDate   DateTime @map("change_date")
  changeType   String   @map("change_type")   // 'INITIAL' | 'ADD' | 'REMOVE'
  sopNo        String   @map("sop_no")
  createdAt    DateTime @default(now()) @map("created_at")

  department VmaDepartment @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@index([departmentId])
  @@index([changeDate])
  @@map("vma_duty_sop_history")
}
