<div class="card glass-card border-0 mb-4 shadow-sm" style="z-index: 100; position: relative;">
    <div class="card-body py-3">
        <div class="row align-items-center gy-3">
            <!-- Mode Selector -->
            <div class="col-md-4">
                <label class="text-white-50 small text-uppercase mb-2 d-block font-monospace"><i
                        class="fas fa-chart-pie me-2"></i><span data-i18n="ui.icon_3455">统计维度 (Mode)</span></label>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="view_mode" id="mode_amount" value="Amount" checked
                        onchange="app.refresh()">
                    <label class="btn btn-outline-light btn-sm" for="mode_amount" data-i18n="ui.text_1666">销售额 ($)</label>

                    <input type="radio" class="btn-check" name="view_mode" id="mode_qty" value="Quantity"
                        onchange="app.refresh()">
                    <label class="btn btn-outline-light btn-sm" for="mode_qty" data-i18n="ui.text_1667">销量 (Qty)</label>

                    <input type="radio" class="btn-check" name="view_mode" id="mode_order" value="Order"
                        onchange="app.refresh()">
                    <label class="btn btn-outline-light btn-sm" for="mode_order" data-i18n="ui.text_1668">订单数 (Ord)</label>

                    <input type="radio" class="btn-check" name="view_mode" id="mode_pct" value="Percentage"
                        onchange="app.refresh()">
                    <label class="btn btn-outline-light btn-sm" for="mode_pct" data-i18n="ui.text_1669">占比 (%)</label>
                </div>
            </div>

            <!-- Date Range -->
            <div class="col-md-3">
                <label class="text-white-50 small text-uppercase mb-2 d-block font-monospace"><i
                        class="far fa-calendar-alt me-2"></i><span data-i18n="ui.icon_3456">时间范围 (Range)</span></label>
                <div class="input-group input-group-sm">
                    <input type="date" id="start_date" class="form-control bg-dark text-white border-secondary"
                        value="{{ default_start }}" onchange="app.refresh()">
                    <span
                        class="input-group-text bg-transparent text-white border-secondary border-start-0 border-end-0">TO</span>
                    <input type="date" id="end_date" class="form-control bg-dark text-white border-secondary"
                        value="{{ default_end }}" onchange="app.refresh()">
                </div>
            </div>

            <!-- Store & Chart Type Controls -->
            <div class="col-md-5">
                <div class="d-flex align-items-center justify-content-between gap-3">

                    <!-- Store Toggle (iOS Style) -->
                    <div>
                        <label class="text-white-50 small text-uppercase mb-2 d-block font-monospace"><i
                                class="fas fa-store me-2"></i><span data-i18n="ui.icon_3457">店铺 (Store)</span></label>
                        <div class="d-flex gap-3">
                            <!-- ES Plus -->
                            <label class="ios-toggle">
                                <input type="checkbox" id="store_esplus" value="esplus" checked
                                    onchange="app.refresh()">
                                <span class="slider"></span>
                                <span class="label-text">ES Plus</span>
                            </label>

                            <!-- Parts 88 -->
                            <label class="ios-toggle">
                                <input type="checkbox" id="store_88" value="88" checked onchange="app.refresh()">
                                <span class="slider"></span>
                                <span class="label-text">Parts 88</span>
                            </label>
                        </div>
                    </div>

                    <!-- Separator -->
                    <div style="width: 1px; height: 30px; background: rgba(255,255,255,0.1);"></div>

                    <!-- Chart Type Switcher (Line vs Pie) -->
                    <div>
                        <label class="text-white-50 small text-uppercase mb-2 d-block font-monospace"><i
                                class="fas fa-layer-group me-2"></i><span data-i18n="ui.icon_3458">视图 (View)</span></label>
                        <label class="chart-type-toggle" style="cursor: pointer;">
                            <input type="checkbox" id="chart_type_switch" onchange="app.toggleChartType()">
                            <span class="type-slider">
                                <i class="fas fa-chart-line icon-left"></i>
                                <i class="fas fa-chart-pie icon-right"></i>
                            </span>
                        </label>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* iOS Toggle Switch */
    .ios-toggle {
        position: relative;
        display: inline-flex;
        align-items: center;
        cursor: pointer;
        user-select: none;
        gap: 8px;
    }

    .ios-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .ios-toggle .slider {
        position: relative;
        width: 44px;
        height: 24px;
        background-color: #4a4a4a;
        border-radius: 34px;
        transition: .3s;
    }

    .ios-toggle .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        border-radius: 50%;
        transition: .3s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .ios-toggle input:checked+.slider {
        background-color: #0d6efd;
    }

    /* Blue Active */
    .ios-toggle input:checked+.slider:before {
        transform: translateX(20px);
    }

    .ios-toggle .label-text {
        color: white;
        font-size: 0.9rem;
        font-family: monospace;
    }

    /* Chart Type Toggle */
    .chart-type-toggle {
        position: relative;
        width: 70px;
        height: 30px;
        display: inline-block;
    }

    .chart-type-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .chart-type-toggle .type-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #0d6efd;
        /* Blue bg */
        border-radius: 30px;
        transition: .3s;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 8px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .chart-type-toggle .type-slider:before {
        position: absolute;
        content: "";
        height: 24px;
        width: 24px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        border-radius: 50%;
        transition: .3s;
        z-index: 2;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .chart-type-toggle input:checked+.type-slider:before {
        transform: translateX(40px);
    }

    .chart-type-toggle .icon-left,
    .chart-type-toggle .icon-right {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        z-index: 1;
    }

    /* Active Icon Highlight Logic? Or just static placement. Static is fine, slider covers one. */
</style>