<!-- Inventory Sync Done -->
<div class="text-center py-5">
    <i class="fa-solid fa-check-circle display-3 text-success mb-3"></i>
    <h4 class="text-white" data-i18n="etl.sync_complete">库存同步完成!</h4>
    <p class="text-success fs-5">
        <i class="fa-solid fa-calendar-check me-2"></i>
        已记录 <strong>{{ target_date }}</strong> 的盘存记录，共 <strong>{{ row_count }}</strong> 条
    </p>

    {% if corrections_applied %}
    <div class="mb-3">
        <span class="badge bg-info">已修正 {{ corrections_applied }} 个 SKU</span>
        {% if skipped_count %}
        <span class="badge bg-warning text-dark ms-1">跳过 {{ skipped_count }} 个</span>
        {% endif %}
    </div>
    {% endif %}

    <button class="btn btn-outline-primary mt-3" hx-get="{% url 'web_ui:inventory:stocktake_etl:tab_inventory' %}"
        hx-target="#inv-process-area">
        <i class="fa-solid fa-rotate me-2"></i><span data-i18n="etl.start_new_sync">开始新同步</span>
    </button>
</div>

<script>
    // Update the stage indicator to show 'done' state
    (function () {
        // Mark all steps as completed
        document.querySelectorAll('.stage-step').forEach(step => {
            step.classList.remove('active');
            step.classList.add('completed');
        });
        document.querySelectorAll('.stage-connector').forEach(conn => {
            conn.classList.add('completed');
        });
        // Replace step numbers with checkmarks
        document.querySelectorAll('.step-box').forEach(box => {
            if (!box.querySelector('.fa-flag-checkered')) {
                box.innerHTML = '<i class="fa-solid fa-check"></i>';
            }
        });
    })();
</script>