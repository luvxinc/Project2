{% load i18n %}
{% load security_tags %}

<div class="card bg-dark border-success border-opacity-25">
    <div class="card-header bg-success bg-opacity-10 border-secondary border-opacity-25">
        <h6 class="mb-0 text-white">
            <i class="fa-solid fa-microchip me-2 text-success"></i>
            <span data-i18n="ui.step2_parse">Step 2: 数据解析 (Parse)</span>
        </h6>
    </div>
    <div class="card-body">
        {% if upload_result %}
        <div class="alert alert-success bg-opacity-10 border-success border-opacity-25 mb-4">
            <i class="fa-solid fa-check-circle me-2"></i>
            <strong data-i18n="ui.text_290">上传成功:</strong> {{ upload_result }}
        </div>
        {% endif %}

        <p class="text-white-50 mb-4" data-i18n="ui.text_291">
            文件已摄入数据库。点击下方按钮启动解析引擎，系统将自动提取 SKU 和数量信息。
        </p>

        <form hx-post="{% url 'web_ui:sales:transactions:parse' %}" hx-target="#etl-tab-content"
            hx-indicator="#parse-spinner">
            {% csrf_token %}

            <div class="d-flex justify-content-center gap-3">
                <div id="parse-spinner" class="htmx-indicator">
                    <div class="spinner-border text-success me-2" role="status"></div>
                    <span class="text-success" data-i18n="ui.text_292">解析引擎运行中，请稍候...</span>
                </div>

                <!-- Cancel Button -->
                <button type="button" class="btn btn-outline-secondary px-4"
                    hx-post="{% url 'web_ui:sales:transactions:cancel' %}" hx-target="#etl-tab-content"
                    hx-confirm="{% trans 'Are you sure you want to cancel? All unsaved data will be lost.' %}">
                    <i class="fa-solid fa-times me-2"></i><span data-i18n="common.cancel">取消</span>
                </button>

                <button type="submit" class="btn btn-success btn-lg px-5">
                    <i class="fa-solid fa-play me-2"></i><span data-i18n="ui.icon_3121">启动解析</span>
                </button>
            </div>
        </form>
    </div>
</div>