{% extends "layouts/base.html" %}
{% load static %}
{% load security_tags %}

{% block title %}Create Shipment - Procurement - ERP System{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- 页面Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item">
                        <a href="{% url 'web_ui:purchase:hub' %}" class="text-info text-decoration-none" data-i18n="purchase.title">Procurement</a>
                    </li>
                    <li class="breadcrumb-item text-white active" aria-current="page" data-i18n="purchase.send_create">Create Shipment</li>
                </ol>
            </nav>
        </div>
        <div>
            <a href="{% url 'web_ui:purchase:hub' %}" 
               class="btn btn-outline-secondary btn-sm" 
               data-bs-toggle="tooltip" 
               data-i18n-title="tooltip.t1444" title="返回采购模块主页">
                <i class="fas fa-arrow-left me-1"></i><span data-i18n="purchase.back_to_hub">返回Procurement</span>
            </a>
        </div>
    </div>

    <!-- 向导容器 -->
    <div id="send-add-wizard-container" class="glass-card p-4 shadow-lg">
        <!-- 向导Header -->
        <div class="wizard-header d-flex flex-column mb-4">
            <div class="d-flex align-items-center">
                <div class="bg-success bg-opacity-25 rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 56px; height: 56px; flex-shrink: 0;">
                    <i class="fas fa-shipping-fast fa-2x text-success"></i>
                </div>
                <div>
                    <h5 class="text-white mb-1" data-i18n="ui.text_455">Create Shipment向导</h5>
                    <p class="text-white-50 small mb-0" data-i18n="ui.text_456">请按步骤填写发货单信息，系统将自动校验并生成发货单。</p>
                </div>
            </div>
            <hr class="border-secondary border-opacity-25 my-4 w-100">
        </div>
        
        <!-- StepBar 锚点 -->
        <div class="wizard-stepbar-anchor" data-wizard-stepbar-anchor="1"></div>

        <!-- 各步骤内容 (通过 include 引入) -->
        {% include "purchase/pages/send_steps/step1_intro.html" %}
        {% include "purchase/pages/send_steps/step2_mode_select.html" %}
        {% include "purchase/pages/send_steps/step3_logistics.html" %}
        {% include "purchase/pages/send_steps/step4_verify_logistics.html" %}
        {% include "purchase/pages/send_steps/step5_items.html" %}
        {% include "purchase/pages/send_steps/step6_verify_items.html" %}
        {% include "purchase/pages/send_steps/step7_preview.html" %}
        {% include "purchase/pages/send_steps/step8_finish.html" %}
    </div>
</div>

<style>
    /* 步骤内容显示控制 - GlobalWizard 通过 active 类控制 */
    .wizard-step-content {
        display: none;
    }
    .wizard-step-content.active {
        display: block;
    }
    
    /* 导航按钮布局 - 返回左对齐，下一步右对齐 */
    .wizard-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* 验证卡片状态样式 */
    .state-normal {
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(13, 202, 240, 0.25);
    }
    .state-normal .card-header {
        background: rgba(13, 202, 240, 0.1);
    }
    
    .state-loading {
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 193, 7, 0.5);
    }
    .state-loading .card-header {
        background: rgba(255, 193, 7, 0.1);
    }
    
    .state-error {
        background: rgba(220, 53, 69, 0.1);
        border: 2px solid var(--bs-danger);
        animation: errorPulse 1.5s ease-in-out infinite;
    }
    .state-error .card-header {
        background: rgba(220, 53, 69, 0.2);
    }
    
    .state-success {
        background: rgba(25, 135, 84, 0.1);
        border: 2px solid var(--bs-success);
    }
    .state-success .card-header {
        background: rgba(25, 135, 84, 0.2);
    }
    
    @keyframes errorPulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
        50% { box-shadow: 0 0 20px 5px rgba(220, 53, 69, 0.3); }
    }
    
    /* 参数表单样式 */
    .param-card {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
    }
    
    .param-row {
        display: flex;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .param-row:last-child {
        border-bottom: none;
    }
    
    .param-label {
        width: 180px;
        flex-shrink: 0;
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
    }
    
    .param-value {
        flex: 1;
    }
    
    .param-value input,
    .param-value select {
        background: rgba(0, 0, 0, 0.5) !important;
        border-color: rgba(255, 255, 255, 0.2) !important;
    }
    
    /* 发货量超出未发量时的橙色闪光提醒 */
    .rounded-warning-flash {
        animation: roundedWarningPulse 1.5s ease-in-out infinite;
        border-color: var(--bs-warning) !important;
        box-shadow: 0 0 10px rgba(255, 193, 7, 0.4);
    }
    
    @keyframes roundedWarningPulse {
        0%, 100% { 
            box-shadow: 0 0 5px 0 rgba(255, 193, 7, 0.4);
            border-color: var(--bs-warning) !important;
        }
        50% { 
            box-shadow: 0 0 15px 3px rgba(255, 193, 7, 0.6);
            border-color: var(--bs-warning) !important;
        }
    }
</style>

<!-- 公有组件 -->
<script src="{% static 'js/global-wizard.js' %}?v=20251228"></script>
<script src="{% static 'js/global-file-upload.js' %}?v=20251228"></script>
<!-- 发货单向导 JavaScript -->
<script src="{% static 'js/send_wizard.js' %}?v=20260115_i18n_v2"></script>
{% endblock %}