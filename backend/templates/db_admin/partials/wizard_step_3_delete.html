{% load i18n %}
{% load security_tags %}

<div class="wizard-step fade-in">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h6 class="text-uppercase text-muted small fw-bold mb-0" data-i18n="ui.text_1743">第三步：删除列</h6>
        <span class="badge bg-danger" data-i18n="ui.text_1744">高危操作</span>
    </div>

    <div class="alert alert-danger bg-opacity-10 border-danger border-opacity-25 d-flex align-items-center mb-4">
        <i class="fas fa-exclamation-triangle text-danger me-3 fs-3"></i>
        <div>
            <strong data-i18n="ui.text_1745">警告：</strong> 您即将删除数据列 <code class="text-white">{{ selected_date }}</code>。<br>
            这将移除该日期下 <strong data-i18n="ui.text_1746">所有 SKU</strong> 的库存数据。
        </div>
    </div>

    <form hx-post="{% url request.resolver_match.namespace|add:':execute_column_delete' %}" hx-target="#update-result"
        hx-confirm="{% trans 'Are you sure you want to delete this data column? This operation is irreversible. Proceed with caution.' %}">
        {% csrf_token %}
        <input type="hidden" name="selected_date" value="{{ selected_date }}">

        <div class="mb-4">
            <label class="form-label text-white-50" data-i18n="ui.text_20">审计原因 (必填)</label>
            <textarea name="reason" class="form-control bg-dark text-white border-secondary font-monospace" rows="3"
                data-i18n-placeholder="form.placeholder.generic_32" placeholder="为什么要删除此列" required></textarea>
        </div>

        <!-- Security Inputs (L4 Gate - High Risk) -->
        <div class="alert alert-danger bg-opacity-10 border-danger border-opacity-25 mb-4">
            <div class="d-flex align-items-center mb-2">
                <i class="fas fa-radiation text-danger me-2"></i>
                <span class="text-white small fw-bold" data-i18n="ui.text_1748">系统级安全验证</span>
            </div>
            <p class="text-white-50 small mb-3" data-i18n="ui.text_1749">此操作涉及物理数据删除，需要最高级别验证。</p>
            {% security_inputs "btn_drop_inv_col" %}
        </div>

        <div class="d-grid">
            <button type="submit" class="btn btn-danger btn-lg">
                <i class="fas fa-trash-alt me-2"></i><span data-i18n="db_admin.execute_delete">执行删除</span>
            </button>
        </div>
    </form>

    <div id="update-result" class="mt-3"></div>

    <div class="mt-4 text-center">
        <a href="{% url request.resolver_match.namespace|add:':data_change' %}"
            class="btn btn-link text-white-50 text-decoration-none">
            <i class="fas fa-arrow-left me-1"></i><span data-i18n="db_admin.restore">重新开始</span>
        </a>
    </div>
</div>