{% load security_tags %}

<div class="wizard-step fade-in">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h6 class="text-uppercase text-muted small fw-bold mb-0" data-i18n="ui.text_1763">第三步：更新 SKU</h6>
        <span class="badge bg-warning text-dark" data-i18n="ui.text_1764">修改模式</span>
    </div>

    <form hx-post="{% url request.resolver_match.namespace|add:':execute_inventory_update' %}"
        hx-target="#update-result">
        {% csrf_token %}
        <input type="hidden" name="selected_date" value="{{ selected_date }}">

        <div class="mb-3">
            <label class="form-label text-white-50" data-i18n="ui.text_338">选择 SKU</label>
            <select name="sku" class="form-select bg-dark text-white border-secondary"
                hx-post="{% url request.resolver_match.namespace|add:':get_sku_val' %}" hx-trigger="change"
                hx-vals='{"selected_date": "{{ selected_date }}"}' hx-target="#current-val">
                <option value="" selected disabled data-i18n="option.o3343">请选择 SKU...</option>
                {% for s in skus %}
                <option value="{{ s }}">{{ s }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="row mb-4">
            <div class="col-6">
                <label class="form-label text-white-50" data-i18n="ui.text_339">当前数值</label>
                <div class="form-control bg-dark border-secondary text-info fw-bold" id="current-val">-</div>
            </div>
            <div class="col-6">
                <label class="form-label text-white-50" data-i18n="ui.text_340">新库存量</label>
                <input type="number" name="new_qty" class="form-control bg-dark text-white border-secondary" required>
            </div>
        </div>

        <!-- Security Inputs (L3 Gate) -->
        <div class="alert alert-secondary bg-opacity-10 border-secondary border-opacity-25 mb-4">
            <div class="d-flex align-items-center mb-2">
                <i class="fas fa-key text-info me-2"></i>
                <span class="text-white-50 small" data-i18n="user_admin.security_verify">安全验证</span>
            </div>
            {% security_inputs "btn_update_single_inv" %}
        </div>

        <div class="d-grid">
            <button type="submit" class="btn btn-warning text-dark fw-bold">
                <i class="fas fa-save me-2"></i><span data-i18n="ui.icon_3010">更新库存</span>
            </button>
        </div>
    </form>

    <div id="update-result" class="mt-3"></div>

    <div class="mt-4 text-center">
        <a href="{% url request.resolver_match.namespace|add:':data_change' %}"
            class="btn btn-link text-white-50 text-decoration-none">
            <i class="fas fa-arrow-left me-1"></i><span data-i18n="ui.icon_3011">重新开始</span>
        </a>
    </div>
</div>