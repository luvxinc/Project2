{% load security_tags %}

<!-- Restore User List Header via OOB -->
<div id="ua-page-header" hx-swap-oob="true">
    {% include "user_admin/components/headers/header_users.html" %}
</div>

<div id="user-list-view" class="fade-in">
    <div class="row g-4">
        <!-- Left: User Table -->
        <div class="col-xl-9 col-lg-8">
            <!-- Apple Style Table Container -->
            <div class="glass-card overflow-hidden shadow-lg h-100">
                <!-- Table Header Bar -->
                <div
                    class="d-flex justify-content-between align-items-center px-4 py-3 border-bottom border-secondary border-opacity-10">
                    <div class="d-flex align-items-center">
                        <i class="fa-solid fa-users text-info me-3 fs-5"></i>
                        <span class="text-white fw-bold" data-i18n="log.filter.all_user">全部用户</span>
                        <span class="badge bg-info bg-opacity-25 text-info ms-3 px-2 py-1">{{ users|length }} 人</span>
                    </div>
                    <div>
                        <!-- 'New User' button removed as per requirements -->
                        <button type="button" class="btn btn-sm btn-outline-secondary rounded-pill px-3"
                            hx-get="{% url 'web_ui:panel_user_list' %}" hx-target="#ua-content-area"
                            hx-swap="innerHTML">
                            <i class="fa-solid fa-rotate me-1"></i><span data-i18n="common.refresh">刷新</span>
                        </button>
                    </div>
                </div>

                <!-- Apple Style Table -->
                <div class="table-responsive">
                    <table class="table mb-0 align-middle user-table">
                        <thead>
                            <tr>
                                <th class="ps-4" data-i18n="log.table.user">用户</th>
                                <th data-i18n="user.role">角色</th>
                                <th data-i18n="common.status">状态</th>
                                <th data-i18n="ui.text_2032">最近登录</th>
                                <th class="text-end pe-4" data-i18n="common.operation">操作</th>
                            </tr>
                        </thead>
                        <tbody id="user-table-body">
                            {% for user in users %}
                            {% include "user_admin/components/users/user_row.html" %}
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-5">
                                    <i class="fa-solid fa-inbox fa-3x text-secondary opacity-50 mb-3"></i>
                                    <p class="text-white-50 mb-0" data-i18n="ui.text_112">暂无用户数据</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Right: Operation Notice (Style matches Capability Page) -->
        <div class="col-xl-3 col-lg-4">
            <div
                class="alert alert-info bg-opacity-10 border-info border-opacity-25 d-flex flex-column mb-0 shadow-sm rounded-3 h-100">
                <div class="d-flex align-items-center mb-3">
                    <i class="fa-solid fa-circle-info text-info me-2 fa-lg"></i>
                    <strong class="text-info" data-i18n="common.operation_notes">操作须知</strong>
                </div>
                <div class="text-white-50 small">
                    <!-- 按钮功能说明 -->
                    <div class="mb-3 pb-3 border-bottom border-secondary border-opacity-25">
                        <div class="text-white-50 fw-bold mb-2">
                            <i class="fa-solid fa-hand-pointer me-1"></i><span data-i18n="ui.icon_3049">操作按钮说明</span>
                        </div>
                        <ul class="mb-0 ps-3 d-flex flex-column gap-1">
                            <li>
                                <i class="fa-solid fa-gear text-info me-1" style="width: 14px;"></i>
                                <strong class="text-info" data-i18n="ui.text_114">齿轮</strong>：<span data-i18n="instructions.desc_68">配置用户的模块访问权限</span>
                            </li>
                            <li>
                                <i class="fa-solid fa-lock-open text-success me-1" style="width: 14px;"></i>
                                <strong class="text-success" data-i18n="ui.text_115">锁/锁开</strong>：<span data-i18n="instructions.desc_22">冻结或恢复用户登录能力</span>
                            </li>
                            <li>
                                <i class="fa-solid fa-circle-up text-success me-1" style="width: 14px;"></i>
                                <strong class="text-success" data-i18n="ui.text_116">升级</strong>：<span data-i18n="instructions.desc_61">将普通用户提升为管理员</span>
                            </li>
                            <li>
                                <i class="fa-solid fa-circle-down text-warning me-1" style="width: 14px;"></i>
                                <strong class="text-warning" data-i18n="ui.text_117">降级</strong>：<span data-i18n="instructions.desc_39">将管理员降为普通用户</span>
                            </li>
                            <li>
                                <i class="fa-solid fa-trash text-danger me-1" style="width: 14px;"></i>
                                <strong class="text-danger" data-i18n="ui.text_118">垃圾桶</strong>：<span data-i18n="instructions.desc_42">永久删除该用户（高风险）</span>
                            </li>
                            <li>
                                <i class="fa-solid fa-key text-warning me-1" style="width: 14px;"></i>
                                <strong class="text-warning" data-i18n="ui.text_119">钥匙</strong>：<span data-i18n="instructions.desc_74">重置该用户的登录密码</span>
                            </li>
                        </ul>
                    </div>
                    <!-- 原有注意事项 -->
                    <div class="text-white-50 fw-bold mb-2">
                        <i class="fa-solid fa-triangle-exclamation me-1"></i><span data-i18n="ui.icon_3050">注意事项</span>
                    </div>
                    <ul class="mb-0 ps-3 d-flex flex-column gap-2">
                        <li>
                            <strong class="text-white-50" data-i18n="ui.text_120">锁定/解锁：</strong>
                            <br>管理员可对违规用户进行临时封锁。
                        </li>
                        <li>
                            <strong class="text-white-50" data-i18n="ui.text_121">角色调整：</strong>
                            <br>涉及权限提权/降级的操作将记录在审计日志中。
                        </li>
                        <li>
                            <strong class="text-white-50" data-i18n="ui.text_122">数据安全：</strong>
                            <br>删除用户为<span class="text-danger" data-i18n="ui.text_123">不可逆操作</span>，请谨慎<span data-i18n="ui.execute">执行</span>。
                        </li>
                        <li>
                            <strong class="text-white-50" data-i18n="ui.text_124">权限生效：</strong>
                            <br>部分敏感权限修改可能需要用户重新登录后生效。
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* ========================================
   Apple Style User Table
   ======================================== */
    .user-table {
        background: transparent;
        border-collapse: separate;
        border-spacing: 0;
    }

    /* Table Header */
    .user-table thead tr {
        background: rgba(255, 255, 255, 0.03);
    }

    .user-table thead th {
        padding: 14px 16px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: rgba(255, 255, 255, 0.5);
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        white-space: nowrap;
    }

    /* Table Body */
    .user-table tbody tr {
        transition: all 0.15s ease;
    }

    .user-table tbody tr:hover {
        background: rgba(255, 255, 255, 0.04);
    }

    .user-table tbody td {
        padding: 16px;
        color: rgba(255, 255, 255, 0.85);
        border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        vertical-align: middle;
    }

    .user-table tbody tr:last-child td {
        border-bottom: none;
    }

    /* User Info Cell */
    .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-avatar {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        flex-shrink: 0;
    }

    .user-avatar.role-superadmin {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.3), rgba(255, 193, 7, 0.3));
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.4);
    }

    .user-avatar.role-admin {
        background: rgba(13, 202, 240, 0.15);
        color: #0dcaf0;
        border: 1px solid rgba(13, 202, 240, 0.3);
    }

    .user-avatar.role-user {
        background: rgba(108, 117, 125, 0.15);
        color: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(108, 117, 125, 0.3);
    }

    .user-name {
        font-weight: 600;
        color: #fff;
        font-size: 14px;
    }

    /* Role Badge */
    .role-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
    }

    .role-badge.superadmin {
        background: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(255, 193, 7, 0.2));
        color: #ffc107;
        border: 1px solid rgba(255, 193, 7, 0.3);
    }

    .role-badge.admin {
        background: rgba(13, 202, 240, 0.15);
        color: #0dcaf0;
        border: 1px solid rgba(13, 202, 240, 0.25);
    }

    .role-badge.user {
        background: rgba(108, 117, 125, 0.15);
        color: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(108, 117, 125, 0.25);
    }

    /* Status Badge */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 500;
    }

    .status-badge.active {
        background: rgba(40, 167, 69, 0.15);
        color: #28a745;
    }

    .status-badge.locked {
        background: rgba(220, 53, 69, 0.15);
        color: #dc3545;
        animation: pulse-status 2s ease-in-out infinite;
    }

    @keyframes pulse-status {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.6;
        }
    }

    /* Last Login */
    .last-login {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
    }

    /* ========================================
   Action Buttons (Unified Icon Style)
   ======================================== */
    .action-buttons {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 4px;
    }

    .action-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: none;
        background: transparent;
        color: rgba(255, 255, 255, 0.4);
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .action-btn:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-1px);
    }

    .action-btn:active {
        transform: translateY(0);
    }

    /* Specific Action Colors */
    .action-btn.action-gear {
        color: #0dcaf0;
    }

    .action-btn.action-gear:hover {
        background: rgba(13, 202, 240, 0.15);
        color: #0dcaf0;
        box-shadow: 0 0 12px rgba(13, 202, 240, 0.3);
    }

    .action-btn.action-lock {
        color: #20c997;
    }

    .action-btn.action-lock:hover {
        background: rgba(220, 53, 69, 0.15);
        color: #dc3545;
        box-shadow: 0 0 12px rgba(220, 53, 69, 0.3);
    }

    .action-btn.action-unlock {
        color: #dc3545;
        animation: pulse-red 1.5s ease-in-out infinite;
    }

    .action-btn.action-unlock:hover {
        background: rgba(40, 167, 69, 0.15);
        color: #28a745;
        animation: none;
        box-shadow: 0 0 12px rgba(40, 167, 69, 0.3);
    }

    .action-btn.action-promote {
        color: #28a745;
    }

    .action-btn.action-promote:hover {
        background: rgba(40, 167, 69, 0.15);
        box-shadow: 0 0 12px rgba(40, 167, 69, 0.3);
    }

    .action-btn.action-demote {
        color: #fd7e14;
    }

    .action-btn.action-demote:hover {
        background: rgba(253, 126, 20, 0.15);
        box-shadow: 0 0 12px rgba(253, 126, 20, 0.3);
    }

    .action-btn.action-delete {
        color: #e685b5;
    }

    .action-btn.action-delete:hover {
        background: rgba(220, 53, 69, 0.15);
        color: #dc3545;
        box-shadow: 0 0 12px rgba(220, 53, 69, 0.3);
    }

    .action-btn.action-key {
        color: #ffc107;
    }

    .action-btn.action-key:hover {
        background: rgba(255, 193, 7, 0.15);
        box-shadow: 0 0 12px rgba(255, 193, 7, 0.3);
    }

    .action-btn.action-key-self {
        color: #0dcaf0;
    }

    .action-btn.action-key-self:hover {
        background: rgba(255, 193, 7, 0.15);
        color: #ffc107;
        box-shadow: 0 0 12px rgba(255, 193, 7, 0.3);
    }

    .action-btn.disabled {
        color: rgba(108, 117, 125, 0.4);
        cursor: not-allowed;
    }

    .action-btn.disabled:hover {
        background: transparent;
        transform: none;
        box-shadow: none;
    }

    /* Pulse Animation */
    @keyframes pulse-red {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    /* HTMX Swapping Animation */
    tr.htmx-swapping {
        opacity: 0;
        transition: opacity 0.3s ease-out;
    }
</style>