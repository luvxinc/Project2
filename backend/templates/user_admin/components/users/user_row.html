<tr id="{{ user.row_id }}" class="fade-me-out">
    {# Column 1: User Info (Avatar + Username) #}
    <td class="ps-4">
        <div class="user-info">
            <div
                class="user-avatar {% if user.role_label == 'Super Admin' %}role-superadmin{% elif user.is_admin %}role-admin{% else %}role-user{% endif %}">
                {{ user.username|first|upper }}
            </div>
            <span class="user-name">{{ user.username }}</span>
        </div>
    </td>

    {# Column 2: Role Badge #}
    <td>
        {% if user.role_label == 'Super Admin' %}
        <span class="role-badge superadmin">
            <i class="fa-solid fa-crown" style="font-size: 9px;"></i>
            Super Admin
        </span>
        {% elif user.is_admin %}
        <span class="role-badge admin">
            <i class="fa-solid fa-shield-halved" style="font-size: 9px;"></i>
            Admin
        </span>
        {% else %}
        <span class="role-badge user">
            <i class="fa-solid fa-user" style="font-size: 9px;"></i>
            User
        </span>
        {% endif %}
    </td>

    {# Column 3: Status #}
    <td>
        {% if user.is_locked %}
        <span class="status-badge locked">
            <i class="fa-solid fa-lock" style="font-size: 9px;"></i>
            已锁定
        </span>
        {% else %}
        <span class="status-badge active">
            <i class="fa-solid fa-circle" style="font-size: 6px;"></i>
            正常
        </span>
        {% endif %}
    </td>

    {# Column 4: Last Login #}
    <td>
        <span class="last-login">{{ user.last_login|default:"从未登录" }}</span>
    </td>

    {# Column 5: Actions #}
    <td class="pe-4">
        <div class="action-buttons">

            {# 1. Gear - Module Permission #}
            {% if user.is_self %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t125" title="无法修改自己的权限"
                onclick="showActionBlockedModal('模块权限管理', '无法修改自己的权限')">
                <i class="fa-solid fa-gear"></i>
            </button>
            {% elif user.role_label == 'Super Admin' %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t9180" title="Super Admin 拥有所有权限"
                onclick="showActionBlockedModal('模块权限管理', 'Super Admin 拥有所有权限，无法修改')">
                <i class="fa-solid fa-gear"></i>
            </button>
            {% elif user.can_manage_perms %}
            <button type="button" class="action-btn action-gear" data-i18n-title="tooltip.t7235" title="模块权限管理"
                hx-get="{% url 'web_ui:permission_form' target_username=user.username %}" hx-target="#ua-content-area"
                hx-swap="innerHTML">
                <i class="fa-solid fa-gear"></i>
            </button>
            {% else %}
            <button type="button" class="action-btn disabled" data-i18n-title="common.no_permission" title="无权限"
                onclick="showActionBlockedModal('模块权限管理', '您没有权限修改该用户的模块权限')">
                <i class="fa-solid fa-gear"></i>
            </button>
            {% endif %}

            {# 2. Lock/Unlock #}
            {% if user.is_self %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t2538" title="无法锁定自己"
                onclick="showActionBlockedModal('锁定/解锁', '无法对自己的账户进行锁定操作')">
                <i class="fa-solid fa-lock"></i>
            </button>
            {% elif user.can_lock %}
            {% if user.is_locked %}
            <button type="button" class="action-btn action-unlock" data-i18n-title="tooltip.t5638" title="解锁账户"
                data-username="{{ user.username }}"
                data-manage-url="{% url 'web_ui:user_manage' target_username=user.username %}"
                data-row-id="{{ user.row_id }}" data-action-type="unlock" onclick="setupLockModal(this)">
                <i class="fa-solid fa-lock"></i>
            </button>
            {% else %}
            <button type="button" class="action-btn action-lock" data-i18n-title="tooltip.t7321" title="锁定账户"
                data-username="{{ user.username }}"
                data-manage-url="{% url 'web_ui:user_manage' target_username=user.username %}"
                data-row-id="{{ user.row_id }}" data-action-type="lock" onclick="setupLockModal(this)">
                <i class="fa-solid fa-lock-open"></i>
            </button>
            {% endif %}
            {% else %}
            <button type="button" class="action-btn disabled" data-i18n-title="common.no_permission" title="无权限"
                onclick="showActionBlockedModal('锁定/解锁', '您没有权限对该用户执行锁定/解锁操作')">
                <i class="fa-solid fa-lock"></i>
            </button>
            {% endif %}

            {# 3. Promote #}
            {% if user.is_self %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t9572" title="无法升级自己"
                onclick="showActionBlockedModal('升级角色', '无法对自己的角色进行升级')">
                <i class="fa-solid fa-circle-up"></i>
            </button>
            {% elif user.role_label == 'Super Admin' or user.is_admin %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t1669"
                title="{% if user.role_label == 'Super Admin' %}已是最高级别{% else %}已是管理员{% endif %}"
                onclick="showActionBlockedModal('升级角色', '{% if user.role_label == 'Super Admin' %}该用户已是最高级别{% else %}该用户已是管理员，无法再升级{% endif %}')">
                <i class="fa-solid fa-circle-up"></i>
            </button>
            {% elif user.can_promote %}
            <button type="button" class="action-btn action-promote" data-i18n-title="tooltip.t5036" title="升级为管理员"
                data-username="{{ user.username }}"
                data-url="{% url 'web_ui:user_change_role' target_username=user.username %}"
                data-row-id="{{ user.row_id }}" data-direction="up" onclick="setupRoleModal(this)">
                <i class="fa-solid fa-circle-up"></i>
            </button>
            {% else %}
            <button type="button" class="action-btn disabled" data-i18n-title="common.no_permission" title="无权限"
                onclick="showActionBlockedModal('升级角色', '您没有权限升级该用户的角色')">
                <i class="fa-solid fa-circle-up"></i>
            </button>
            {% endif %}

            {# 4. Demote #}
            {% if user.is_self %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t2596" title="无法降级自己"
                onclick="showActionBlockedModal('降级角色', '无法对自己的角色进行降级')">
                <i class="fa-solid fa-circle-down"></i>
            </button>
            {% elif user.role_label == 'Super Admin' %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t8263" title="无法降级 Super Admin"
                onclick="showActionBlockedModal('降级角色', 'Super Admin 账户受保护，无法降级')">
                <i class="fa-solid fa-circle-down"></i>
            </button>
            {% elif not user.is_admin %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t3226" title="已是普通用户"
                onclick="showActionBlockedModal('降级角色', '该用户已是普通用户，无法再降级')">
                <i class="fa-solid fa-circle-down"></i>
            </button>
            {% elif user.can_demote %}
            <button type="button" class="action-btn action-demote" data-i18n-title="user_admin.btn_demote"
                title="降级为普通用户" data-username="{{ user.username }}"
                data-url="{% url 'web_ui:user_change_role' target_username=user.username %}"
                data-row-id="{{ user.row_id }}" data-direction="down" onclick="setupRoleModal(this)">
                <i class="fa-solid fa-circle-down"></i>
            </button>
            {% else %}
            <button type="button" class="action-btn disabled" data-i18n-title="common.no_permission" title="无权限"
                onclick="showActionBlockedModal('降级角色', '您没有权限降级该用户的角色')">
                <i class="fa-solid fa-circle-down"></i>
            </button>
            {% endif %}

            {# 5. Delete #}
            {% if user.is_self %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t3898" title="无法删除自己"
                onclick="showActionBlockedModal('删除用户', '无法删除自己的账户')">
                <i class="fa-solid fa-trash"></i>
            </button>
            {% elif user.role_label == 'Super Admin' %}
            <button type="button" class="action-btn disabled" data-i18n-title="tooltip.t9762" title="无法删除 Super Admin"
                onclick="showActionBlockedModal('删除用户', 'Super Admin 账户受保护，无法删除')">
                <i class="fa-solid fa-trash"></i>
            </button>
            {% elif user.can_delete %}
            <button type="button" class="action-btn action-delete" data-i18n-title="user_admin.modal.delete_user"
                title="删除用户" onclick="setupDeleteModal('{{ user.username }}')">
                <i class="fa-solid fa-trash"></i>
            </button>
            {% else %}
            <button type="button" class="action-btn disabled" data-i18n-title="common.no_permission" title="无权限"
                onclick="showActionBlockedModal('删除用户', '您没有权限删除该用户')">
                <i class="fa-solid fa-trash"></i>
            </button>
            {% endif %}

            {# 6. Key - Reset Password #}
            {% if user.is_self %}
            <button type="button" class="action-btn action-key-self" data-i18n-title="modal.change_password.title"
                title="修改我的密码" onclick="setupResetSelfModal('{{ user.username }}')">
                <i class="fa-solid fa-key"></i>
            </button>
            {% elif user.can_reset %}
            <button type="button" class="action-btn action-key" data-i18n-title="user_admin.reset_password" title="重置密码"
                onclick="setupResetModal('{{ user.username }}')">
                <i class="fa-solid fa-key"></i>
            </button>
            {% else %}
            <button type="button" class="action-btn disabled" data-i18n-title="common.no_permission" title="无权限"
                onclick="showActionBlockedModal('重置密码', '您没有权限重置该用户的密码')">
                <i class="fa-solid fa-key"></i>
            </button>
            {% endif %}

        </div>
    </td>
</tr>