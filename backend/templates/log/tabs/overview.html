<!-- log/tabs/overview.html - 概览 Tab -->
{% load log_filters %}
<div class="py-3">
    <!-- 统计卡片 -->
    <div class="row g-3 mb-4">
        <!-- 错误统计 -->
        <div class="col-md-3">
            <div class="p-3 rounded" style="background: rgba(220, 53, 69, 0.06); border: 1px solid rgba(220, 53, 69, 0.15);">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="text-white fs-3 fw-semibold">{{ stats.error_today }}</div>
                        <div class="text-white-50 small" data-i18n="log.stats.today_errors">今日错误</div>
                    </div>
                    <i class="fas fa-circle-xmark fa-lg text-danger" style="opacity: 0.4;"></i>
                </div>
                <div class="mt-2 small">
                    <span class="text-white-50"><span data-i18n="log.stats.week_total">本周</span>: {{ stats.error_week }}</span>
                    {% if stats.error_unresolved > 0 %}
                    <span class="ms-2 text-warning"><span data-i18n="log.stats.unresolved">未解决</span>: {{ stats.error_unresolved }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- 审计统计 -->
        <div class="col-md-3">
            <div class="p-3 rounded" style="background: rgba(13, 110, 253, 0.06); border: 1px solid rgba(13, 110, 253, 0.15);">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="text-white fs-3 fw-semibold">{{ stats.audit_today }}</div>
                        <div class="text-white-50 small" data-i18n="log.stats.today_audit">今日审计</div>
                    </div>
                    <i class="fas fa-shield-halved fa-lg text-primary" style="opacity: 0.4;"></i>
                </div>
                <div class="mt-2 small">
                    <span class="text-white-50">登录: {{ stats.login_today }}</span>
                    {% if stats.login_failed_today > 0 %}
                    <span class="ms-2 text-warning">失败: {{ stats.login_failed_today }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- 业务统计 -->
        <div class="col-md-3">
            <div class="p-3 rounded" style="background: rgba(25, 135, 84, 0.06); border: 1px solid rgba(25, 135, 84, 0.15);">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="text-white fs-3 fw-semibold">{{ stats.business_today }}</div>
                        <div class="text-white-50 small" data-i18n="log.stats.today_ops">今日操作</div>
                    </div>
                    <i class="fas fa-clipboard-list fa-lg text-success" style="opacity: 0.4;"></i>
                </div>
                <div class="mt-2 small text-white-50">
                    本周: {{ stats.business_week }}
                </div>
            </div>
        </div>
        
        <!-- 访问统计 -->
        <div class="col-md-3">
            <div class="p-3 rounded" style="background: rgba(13, 202, 240, 0.06); border: 1px solid rgba(13, 202, 240, 0.15);">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="text-white fs-3 fw-semibold">{{ stats.access_today }}</div>
                        <div class="text-white-50 small" data-i18n="log.stats.today_access">今日请求</div>
                    </div>
                    <i class="fas fa-globe fa-lg text-info" style="opacity: 0.4;"></i>
                </div>
                <div class="mt-2 small">
                    {% if stats.access_errors > 0 %}
                    <span class="text-warning">异常: {{ stats.access_errors }}</span>
                    {% else %}
                    <span class="text-white-50" data-i18n="ui.text_1145">全部正常</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="row g-4">
        <!-- 最近错误 -->
        <div class="col-md-6">
            <div class="rounded" style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06);">
                <div class="px-3 py-2 d-flex justify-content-between align-items-center" style="border-bottom: 1px solid rgba(255, 255, 255, 0.06);">
                    <span class="text-white-50 small">
                        <i class="fas fa-exclamation-triangle me-2" style="opacity: 0.6;"></i><span data-i18n="log.recent_errors">最近错误</span>
                    </span>
                    <button class="btn btn-link btn-sm text-info p-0" onclick="document.querySelector('[data-tab=error]').click()" data-i18n="common.view_all">查看全部</button>
                </div>
                <div class="p-0">
                    {% if recent_errors %}
                    {% for log in recent_errors %}
                    <div class="px-3 py-2" style="border-bottom: 1px solid rgba(255, 255, 255, 0.04);">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1" style="min-width: 0;">
                                <div class="text-white text-truncate small" title="{{ log.error_message }}">
                                    <code class="text-danger" style="font-size: 11px;">{{ log.error_type }}</code>: {{ log.error_message|truncatechars:40 }}
                                </div>
                                <small class="text-white-50" style="font-size: 11px;">
                                    {{ log.request_path|default:"-"|truncatechars:30 }} · {{ log.user|mask_user:god_mode }}
                                </small>
                            </div>
                            <div class="text-end ms-2" style="white-space: nowrap;">
                                <small class="text-white-50" style="font-size: 10px;">{{ log.created_at|timesince }} 前</small>
                                <br>
                                <span class="severity-badge severity-{{ log.severity|lower }}">{{ log.severity }}</span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="text-center text-white-50 py-4">
                        <i class="fas fa-check-circle mb-2" style="opacity: 0.4;"></i>
                        <p class="mb-0 small" data-i18n="log.no_errors">暂无错误记录</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- 最近登录 -->
        <div class="col-md-6">
            <div class="rounded" style="background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.06);">
                <div class="px-3 py-2 d-flex justify-content-between align-items-center" style="border-bottom: 1px solid rgba(255, 255, 255, 0.06);">
                    <span class="text-white-50 small">
                        <i class="fas fa-user-check me-2" style="opacity: 0.6;"></i><span data-i18n="log.recent_logins">登录记录</span>
                    </span>
                    <button class="btn btn-link btn-sm text-info p-0" onclick="document.querySelector('[data-tab=audit]').click()" data-i18n="common.view_all">查看全部</button>
                </div>
                <div class="p-0">
                    {% if recent_logins %}
                    {% for log in recent_logins %}
                    <div class="px-3 py-2" style="border-bottom: 1px solid rgba(255, 255, 255, 0.04);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="text-white small">{{ log.actor_username }}</span>
                                <small class="text-white-50 ms-2" style="font-size: 11px;">{{ log.actor_ip|default:"-" }}</small>
                            </div>
                            <div class="text-end">
                                {% if log.action == 'LOGIN_SUCCESS' %}
                                <span class="status-badge status-resolved" data-i18n="toast.success">成功</span>
                                {% else %}
                                <span class="status-badge status-failed" data-i18n="toast.failed">失败</span>
                                {% endif %}
                                <br>
                                <small class="text-white-50" style="font-size: 10px;">{{ log.created_at|timesince }} 前</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="text-center text-white-50 py-4">
                        <i class="fas fa-user mb-2" style="opacity: 0.4;"></i>
                        <p class="mb-0 small" data-i18n="log.no_logins">暂无登录记录</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* 严重性徽章 */
.severity-badge {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 9px;
    font-weight: 500;
}

.severity-critical {
    background: rgba(220, 38, 38, 0.15);
    color: #f87171;
    border: 1px solid rgba(220, 38, 38, 0.3);
}

.severity-high {
    background: rgba(234, 88, 12, 0.15);
    color: #fb923c;
    border: 1px solid rgba(234, 88, 12, 0.3);
}

.severity-medium {
    background: rgba(202, 138, 4, 0.15);
    color: #fbbf24;
    border: 1px solid rgba(202, 138, 4, 0.3);
}

.severity-low {
    background: rgba(22, 163, 74, 0.15);
    color: #4ade80;
    border: 1px solid rgba(22, 163, 74, 0.3);
}

/* 状态徽章 */
.status-badge {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 9px;
    font-weight: 500;
}

.status-resolved {
    background: rgba(22, 163, 74, 0.15);
    color: #4ade80;
    border: 1px solid rgba(22, 163, 74, 0.25);
}

.status-failed {
    background: rgba(220, 53, 69, 0.15);
    color: #f87171;
    border: 1px solid rgba(220, 53, 69, 0.25);
}
</style>