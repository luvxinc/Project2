# Generated by Django 5.1.1 on 2026-01-11 03:54

from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='LogAccess',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='创建时间')),
                ('trace_id', models.CharField(db_index=True, max_length=36, verbose_name='链路ID')),
                ('user', models.CharField(blank=True, max_length=64, null=True, verbose_name='用户')),
                ('ip', models.CharField(max_length=45, verbose_name='IP地址')),
                ('user_agent', models.CharField(blank=True, max_length=512, null=True, verbose_name='User-Agent')),
                ('method', models.CharField(max_length=8, verbose_name='HTTP方法')),
                ('path', models.CharField(db_index=True, max_length=512, verbose_name='请求路径')),
                ('query_string', models.CharField(blank=True, max_length=1024, null=True, verbose_name='Query参数')),
                ('request_size', models.IntegerField(blank=True, null=True, verbose_name='请求大小')),
                ('status_code', models.IntegerField(db_index=True, verbose_name='状态码')),
                ('response_size', models.IntegerField(blank=True, null=True, verbose_name='响应大小')),
                ('response_time_ms', models.IntegerField(db_index=True, verbose_name='响应时间(ms)')),
                ('dev_mode', models.BooleanField(db_index=True, default=False, verbose_name='开发模式')),
            ],
            options={
                'verbose_name': '访问日志',
                'verbose_name_plural': '访问日志',
                'db_table': 'log_access',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LogAudit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='创建时间')),
                ('trace_id', models.CharField(db_index=True, max_length=36, verbose_name='链路ID')),
                ('event_id', models.CharField(blank=True, max_length=16, null=True, verbose_name='事件ID')),
                ('actor_id', models.IntegerField(blank=True, null=True, verbose_name='操作人ID')),
                ('actor_username', models.CharField(db_index=True, max_length=64, verbose_name='操作人用户名')),
                ('actor_role', models.CharField(blank=True, max_length=32, null=True, verbose_name='操作人角色')),
                ('actor_ip', models.CharField(blank=True, max_length=45, null=True, verbose_name='操作人IP')),
                ('action', models.CharField(db_index=True, max_length=64, verbose_name='动作')),
                ('action_category', models.CharField(blank=True, choices=[('AUTH', '认证'), ('AUTHZ', '授权'), ('DATA', '数据'), ('CONFIG', '配置'), ('ADMIN', '管理')], max_length=16, null=True, verbose_name='动作分类')),
                ('target_type', models.CharField(blank=True, max_length=64, null=True, verbose_name='目标类型')),
                ('target_id', models.CharField(blank=True, max_length=128, null=True, verbose_name='目标ID')),
                ('target_name', models.CharField(blank=True, max_length=256, null=True, verbose_name='目标名称')),
                ('before_state', models.JSONField(blank=True, null=True, verbose_name='变更前状态')),
                ('after_state', models.JSONField(blank=True, null=True, verbose_name='变更后状态')),
                ('change_summary', models.CharField(blank=True, max_length=512, null=True, verbose_name='变更摘要')),
                ('result', models.CharField(choices=[('SUCCESS', '成功'), ('DENIED', '拒绝'), ('FAILED', '失败')], max_length=16, verbose_name='结果')),
                ('deny_reason', models.CharField(blank=True, max_length=256, null=True, verbose_name='拒绝原因')),
                ('fail_reason', models.CharField(blank=True, max_length=256, null=True, verbose_name='失败原因')),
                ('risk_level', models.CharField(choices=[('CRITICAL', '严重'), ('HIGH', '高'), ('MEDIUM', '中'), ('LOW', '低')], default='MEDIUM', max_length=16, verbose_name='风险等级')),
                ('log_type', models.CharField(choices=[('REGULAR', '常规'), ('PERMANENT', '永久')], default='REGULAR', max_length=16, verbose_name='日志类型')),
                ('dev_mode', models.BooleanField(db_index=True, default=False, verbose_name='开发模式')),
            ],
            options={
                'verbose_name': '安全审计日志',
                'verbose_name_plural': '安全审计日志',
                'db_table': 'log_audit',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['actor_username', 'created_at'], name='log_audit_actor_u_4430eb_idx')],
            },
        ),
        migrations.CreateModel(
            name='LogBusiness',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='创建时间')),
                ('trace_id', models.CharField(db_index=True, max_length=36, verbose_name='链路ID')),
                ('event_id', models.CharField(blank=True, max_length=16, null=True, verbose_name='事件ID')),
                ('user', models.CharField(db_index=True, max_length=64, verbose_name='用户')),
                ('ip', models.CharField(blank=True, max_length=45, null=True, verbose_name='IP地址')),
                ('module', models.CharField(db_index=True, max_length=32, verbose_name='模块')),
                ('page_path', models.CharField(blank=True, max_length=256, null=True, verbose_name='页面路径')),
                ('action', models.CharField(db_index=True, max_length=64, verbose_name='动作')),
                ('target_type', models.CharField(blank=True, max_length=64, null=True, verbose_name='目标类型')),
                ('target_id', models.CharField(blank=True, max_length=128, null=True, verbose_name='目标ID')),
                ('summary', models.CharField(max_length=256, verbose_name='摘要')),
                ('details', models.JSONField(blank=True, null=True, verbose_name='详情')),
                ('status', models.CharField(choices=[('SUCCESS', '成功'), ('FAILED', '失败')], max_length=16, verbose_name='状态')),
                ('duration_ms', models.IntegerField(blank=True, null=True, verbose_name='耗时(ms)')),
                ('dev_mode', models.BooleanField(db_index=True, default=False, verbose_name='开发模式')),
            ],
            options={
                'verbose_name': '业务操作日志',
                'verbose_name_plural': '业务操作日志',
                'db_table': 'log_business',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['user', 'created_at'], name='log_busines_user_62e9be_idx'), models.Index(fields=['module', 'action'], name='log_busines_module_832018_idx')],
            },
        ),
        migrations.CreateModel(
            name='LogError',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, verbose_name='创建时间')),
                ('trace_id', models.CharField(db_index=True, max_length=36, verbose_name='链路ID')),
                ('user', models.CharField(default='System', max_length=64, verbose_name='用户')),
                ('ip', models.CharField(blank=True, max_length=45, null=True, verbose_name='IP地址')),
                ('user_agent', models.CharField(blank=True, max_length=512, null=True, verbose_name='User-Agent')),
                ('session_id', models.CharField(blank=True, max_length=64, null=True, verbose_name='Session ID')),
                ('http_method', models.CharField(blank=True, max_length=8, null=True, verbose_name='HTTP方法')),
                ('request_path', models.CharField(blank=True, db_index=True, max_length=512, null=True, verbose_name='请求路径')),
                ('query_params', models.TextField(blank=True, null=True, verbose_name='Query参数')),
                ('request_body', models.TextField(blank=True, null=True, verbose_name='请求体')),
                ('request_headers', models.TextField(blank=True, null=True, verbose_name='请求头')),
                ('content_type', models.CharField(blank=True, max_length=128, null=True, verbose_name='Content-Type')),
                ('error_type', models.CharField(max_length=256, verbose_name='异常类型')),
                ('error_message', models.TextField(verbose_name='错误消息')),
                ('error_code', models.CharField(blank=True, max_length=32, null=True, verbose_name='错误码')),
                ('traceback_full', models.TextField(blank=True, null=True, verbose_name='完整堆栈')),
                ('file_path', models.CharField(blank=True, max_length=512, null=True, verbose_name='文件路径')),
                ('function_name', models.CharField(blank=True, max_length=128, null=True, verbose_name='函数名')),
                ('line_number', models.IntegerField(blank=True, null=True, verbose_name='行号')),
                ('module_name', models.CharField(blank=True, max_length=128, null=True, verbose_name='模块名')),
                ('local_variables', models.TextField(blank=True, null=True, verbose_name='局部变量')),
                ('severity', models.CharField(choices=[('CRITICAL', '严重'), ('HIGH', '高'), ('MEDIUM', '中'), ('LOW', '低')], db_index=True, default='HIGH', max_length=16, verbose_name='严重程度')),
                ('category', models.CharField(blank=True, max_length=64, null=True, verbose_name='分类')),
                ('is_resolved', models.BooleanField(db_index=True, default=False, verbose_name='已解决')),
                ('resolved_by', models.CharField(blank=True, max_length=64, null=True, verbose_name='解决人')),
                ('resolved_at', models.DateTimeField(blank=True, null=True, verbose_name='解决时间')),
                ('resolution_note', models.TextField(blank=True, null=True, verbose_name='解决备注')),
                ('dev_mode', models.BooleanField(db_index=True, default=False, verbose_name='开发模式')),
                ('error_hash', models.CharField(blank=True, db_index=True, max_length=64, null=True, verbose_name='错误哈希')),
            ],
            options={
                'verbose_name': '错误日志',
                'verbose_name_plural': '错误日志',
                'db_table': 'log_error',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['severity', 'is_resolved'], name='log_error_severit_46998e_idx')],
            },
        ),
    ]
