我们现在需要对于 用户权限管理 和 安全审计日志 这两个模块进行深度的检验
在测试之前我给你这两个板块的逻辑和联动规则
你要记得我们的要求 高代码复用 做好顶头和代码注释, 每个功能都必须实现, 遇到问题修正
做好文件夹整体的架构和规划
这计划也需要加入 你的测试 你需要测试所有功能, 你可以自己去注册用户 测试 那些密码都在环境变量中你可以去读取
在测试中 因为你修改了LOG的方式 可能修改之前的LOG就不好识别 你可以先把老的记录删除了 我不需要了 这样方便你测试
所以你需要验证这两个板块里的全部逻辑 所有组合 确定功能性正确 不出错
注意所有的功能都要做全量测试 (也就是所有可交互的都要测试, 尤其是LOG记录方面是否make sense)

你先根据我说的内容 做一个整体planning 我看看我们再继续



对于 用户权限管理 
1 注册用户
    1.1. 只有super admin和admin登录后可以使用, 其他用户看这个tab是灰色的无法点击 就是没有权限看到的图标都是灰色且无法点击
    1.2. 用于注册新用户,需要输入用户名,选择role, 不能为super admin, 若admin注册只能是user
    1.3. 注册用户时需要密码策略矩阵控制
    1.4. admin的这个功能权限受到职能开关tab的控制
2 用户列表tab
    1.1. 盾牌按钮->板块控制
        此项打开会触发板块控制弹窗
        板块控制弹窗中
        1.1.1 各个板块的权限控制,这个在json文件中, 后续更新功能和模块控制需要去更新json文件
        1.1.2 修改后确认修改会触发板块功能权限设置, 没有权限的用户这个图标是灰色的无法点击
        1.1.3 admin的这个权限能否被开启 在职能开关tab里受到super admin的控制
        1.1.4 权限管理需要密码管理, 用什么密码由密码策略矩阵控制
        1.1.5 板块控制只有super admin和admin登录后可以使用, 其他用户点击后显示无权限提示
        1.1.6 super admin具备最高权限可以管理所有人的模块, 而admin则只能管理自己和用户的权限, 且范围受控于他自己的权限, 若他没有权限, 则他也不可以给与用户权限
    1.2. 钥匙按钮->重置密码
        1.2.1 当用户点击自己时用于重置自己的密码
        1.2.2 super admin和admin登录后可以强制修改比自己role低的用户的密码, 普通用户看别人以及admin看super admin的这个图标是灰色的无法点击 就是没有权限看到的图标都是灰色且无法点击        
        1.2.3 重置密码后需要密码策略矩阵控制
        1.2.4 有权限的用户在修改别人的密码时,这个功能需要密码管理, 用什么密码由密码策略矩阵控制
        1.2.5 修改自己的密码不需要密码策略矩阵控制, 只需要输入旧密码, 再输入两次新密码即可
        1.2.6 修改别人的密码需要通过密码策略矩阵的密码验证,输入两次新密码, 然后点击确认修改
        1.2.7 admin的这个权限能否被开启 在职能开关tab里受到super admin的控制
    1.3. 上下箭头按钮->用户role升降
        1.3.1 上箭头是升级, 下箭头是降级
        1.3.2 super admin和admin登录后可以修改比自己role低的用户的role, 普通用户看别人以及admin看super admin的这个图标是灰色的无法点击 就是没有权限看到的图标都是灰色且无法点击
        1.3.3 admin 能否修改role升级是受到super admin的控制这个在 职能开关里 普通用户没有权限
        1.3.4 当没有权限时, 两个箭头都是灰色的无法点击
        1.3.5 在升级降级的时候会触发密码策略矩阵的密码验证, 然后点击确认修改
        1.3.6 admin的这个权限能否被开启 在职能开关tab里受到super admin的控制
    1.4. 锁按钮->用户锁定/解锁
        1.4.1 这个是用于锁定用户账号, 让其无法登录, 当用户连续输入错5次任何密码时也会自动触发锁定, super admin则不会
        1.4.2 super admin和admin登录后可以修改比自己role低的用户的账号锁定状态, 普通用户看别人以及admin看super admin的这个图标是灰色的无法点击 就是没有权限看到的图标都是灰色且无法点击
        1.4.3 当没有权限时, 锁按钮都是灰色的无法点击
        1.4.4 当锁定时, 无法登录, 当解锁时, 可以登录
        1.4.5 有权限的用户点击这个按钮 无论是锁定还是解锁都会触发密码策略矩阵的密码验证, 然后点击确认修改
        1.4.6 admin的这个权限能否被开启 在职能开关tab里受到super admin的控制
    1.5. 垃圾桶按钮->用户删除
        1.5.1 这个是用于删除用户账号, 无法恢复
        1.5.2 super admin和admin登录后可以删除比自己role低的用户的账号, 普通用户看别人以及admin看super admin的这个图标是灰色的无法点击 就是没有权限看到的图标都是灰色且无法点击
        1.5.3 当没有权限时, 垃圾桶按钮都是灰色的无法点击
        1.5.4 有权限的用户点击这个按钮 无论是删除还是恢复都会触发密码策略矩阵的密码验证, 然后点击确认修改, 同时删除强制输入删除理由 这个日后会被记录入log的Note列
        1.5.5 admin的这个权限能否被开启 在职能开关tab里受到super admin的控制
3. 密码策略矩阵tab
    2.1. 这里的选项是管理各种功能模块的密码要求 被打钩的就是要求输入的密码 可能有1个或多个 没有任何被选中就是不需要密码
    2.2. 功能模块的列表源于json文件
    2.3  后面有保存按钮 不需要密码
    2.4  这个功能只有super admin和admin登录后可以使用, 其他用户看这个tab是灰色的无法点击 就是没有权限看到的图标都是灰色且无法点击
    2.5  admin的这个权限能否被开启 在职能开关tab里受到super admin的控制
    2.6  在点击保存后, 策略要立刻生效, 不能有延迟

4. 职能开关tab
    4.1 这个功能只有super admin 可以用
    4.2 这个功能控制 用户列表tab的几个功能是否能被admin使用在比其职级更低的用户上
    4.3 此项功能点击确定修改后需要立刻生效, 不能有延迟, 也不需要任何密码验证


对于安全审计日志:
1. 清空日志
    1.1 此项只有super admin可以使用, 其他人是灰色的无法点击
    1.2 点击清空日志后, 会弹出一个确认框, 需要选择日期区间 确认后会触发密码策略矩阵的密码验证, 然后点击确认删除, 同时删除强制输入删除理由 注意这个操作的type是Permanent
    1.3 通过密码矩阵验证后, 所有日志都会被删除
    1.4 当用户选择清空日志 并输入正确验证后 在系统清空日志前, 系统需要对被删除的日志做个备份, 存为ref_时间戳_log名字.txt形式放在项目文件夹你需要去规划
    1.5 且修改 业务日志 里的关于用户删除日志的Permanent的记录的NOTE列规则, 满足这样情况时候, 不再写入理由, 而是变成一个按钮, 叫做下载备份, 该备份按钮指向对应的备份文件, 若文件不存在,则说文件丢失
    1.6 备份的ref_时间戳_log名字.txt 的开头一定要详细说明 此log是什么时候被什么人删除的, 理由是什么
    1.7 点击按钮会下载文件
    1.8 注意在业务日志里记录
2. 上帝模式
    2.1 此项只有super admin和admin可以使用, 其他人是灰色的无法点击
    2.2 admin的这个权限能否被开启 在职能开关tab里受到super admin的控制
    2.3 点击上帝模式后, 会弹出一个确认框, 确认后会触发密码策略矩阵的密码验证, 然后点击确认 确认后会取消隐藏安全审计日志里的全部数据, 显示真实数据
    2.4 然后按钮变成上锁, 用户可以点击上锁, 此时不需要密码, 上锁后取消显示隐藏
3. 业务操作tab
    3.1 Time
        3.1.1 记录操作的时间
        3.1.2 格式为 2025-12-15 17:36:52
    3.2 Ref ID
        3.2.1 记录操作的ID: 这个ID是系统生成的唯一号码不可重复
    3.3 User/IP
        3.3.1 记录操作的用户
        3.3.2 记录操作的IP
    3.4 Page
        3.4.1 该列修改成为详细记录用户的操作的板块
        3.4.2 格式为 左侧导航栏功能选项->该功能的TAB选项(如果没有则跳过)->具体的TAB下的功能按钮(如果没有则跳过)
        3.4.3 上述记录必须有逻辑约定, 该约定为一个合并性规则, 规则如下
            3.4.3.1 层级从高到低次序为, 左侧导航栏功能>该功能下的tab(如果存在)>该tab下的按钮
            3.4.3.2 在返回上一级层级之前,直到最低层级记录为一个
            3.4.3.3 若用户刷新当前页面, 返回上一级页面, 登出, 则需要记录为新的记录
        3.4.4 用户的登录和登出需单独作为一个, 这里的Page列应为 登入/登出
    3.5 Action
        3.5.1 若Page为用户登录和登出时, 这里则也是登录或者登出
        3.5.2 若Page为功能选项时
            3.5.2.1 若用户仅是访问页面 没有别的操作(没有点击任何按钮) 为 查看页面
            3.5.2.2 若用户使用了该页面的某个可以点击具备执行功能的按钮
            3.5.2.2.1 若该按钮背后的功能 涉及到与SQL数据库表格内容 原有数据查询 这里为 查询数据 (若用户行为也涵盖 修改数据 或 删除数据时, 此项忽略)
            3.5.2.2.2 若该按钮背后的功能 涉及到与SQL数据库表格内容 原有数据修改 这里为 修改数据
            3.5.2.2.3 若该按钮背后的功能 涉及到与SQL数据库表格内容 原有数据删除 这里为 删除数据
            3.5.2.2.4 若该按钮背后的功能 涉及到与SQL数据库表格内容 原有数据新增(注意区别于修改, 新增属于append的形式) 这里为 新增数据
            3.5.2.2.5 若该按钮背后的功能 涉及到与服务器端某个记录文件(例如txt,env, json等)的内容的原有数据查询 这里为 查询设置 (若用户行为也涵盖 修改设置 或 删除设置时, 此项忽略)
            3.5.2.2.6 若该按钮背后的功能 涉及到与服务器端某个记录文件(例如txt,env, json等)的内容的原有数据修改 这里为 修改设置
            3.5.2.2.7 若该按钮背后的功能 涉及到与服务器端某个记录文件(例如txt,env, json等)的内容的原有数据删除 这里为 删除设置
            3.5.2.2.8 若该按钮背后的功能 涉及到与服务器端某个记录文件(例如txt,env, json等)的内容的新增(注意区别于修改,新增属于append的形式) 这里为 新增设置
            3.5.2.2.10 若该按钮背后的功能 都不满足上述条件 则记录为 启动功能
            3.5.2.2.11 若用户的按钮动作涵盖多个 行为 都要被记录 用/隔开
    3.6 Status列
        3.6.1 此列仅存在两种大的取值, 成功 或 失败
        3.6.2 成功: 仅限于用户此项按钮或者页面访问整个流程成功. 没有任何系统或者UI页面级别的报错
        3.6.3 失败: 仅限于用户此项按钮或者页面访问整个流程没有成功
    3.7 Root Cause列
        3.7.1 如status列是成功, 这里为-
        3.7.2 如status列是失败
            3.7.2.1 若是系统级别的报错 则是 系统
            3.7.2.2 若是权限级别的报错 则是 权限
            3.7.2.3 若是数据格式报错 则是 数据
            3.7.2.4 若是UI界面的报错 则是 UI
            3.7.2.5 若是上述情况都不满足 则是 其他
    3.8 details列 (注意在非上帝视角模式下, 这里所有的数据在页面隐藏显示为*******)
        3.8.1 此列需要修改为仅记录用户的操作的详细details, 也就是 之前内容->之后内容
        3.8.2 我给你一堆例子你参考逻辑 诸如此类 你需要设计成为这样 或者更具体 (你这里要设计一下,目的是为了详细记录用户足迹,让管理人员看到用户的操作和修改)
            3.8.2.1 table=/dashboard/user_admin/tab/users/ | method=GET | path=/dashboard/user_admin/tab/users/ | status_code=200 | duration_ms=8 | hx=1 | tab=用户列表 | op=切换TAB
            3.8.2.2 table=/dashboard/db_admin/ | method=GET | path=/dashboard/db_admin/ | status_code=404 | duration_ms=8 | hx=0 | tab=页面 | op=访问
            3.8.2.3 table=/dashboard/audit/action/lock/ | method=GET | path=/dashboard/audit/action/lock/ | status_code=500 | duration_ms=19 | hx=0 | tab=概览 | op=打开页面
            3.8.2.4 table=[ROOT]/data/security_overrides.json | method=POST | path=/dashboard/user_admin/policy/update/ | status_code=200 | duration_ms=5 | hx=1 | tab=密码策略矩阵 | op=保存策略 | note={"action_key":"btn_unlock_view","token_count":2} | changes={"before":{"tokens":["modify","db","system"]},"after":{"tokens":["modify","db"]}}
    3.9 type列
        3.9.1 此列只有Regular和Permanent两种取值
        3.9.2 Permanent: 例如super admin清空日志的操作 和 日后我说的必须为permannent的记录的功能
        3.9.3 Regular: 除上述情况外的其他情况
    3.10 note列
        3.10.1  用于记录一些特殊原因 要求用户录入操作的理由

4. 底层数据TAB 的规范
    若在业务操作中 有涉及到和SQL数据库的交互都要被记录到这里
    4.1 Time 和别的表格中一致 记录操作时间
    4.2 User/IP
        4.2.1 User/IP 记录操作用户和他的IP
    4.3 REF ID
        4.3.1 REF ID则对齐相关操作的在 业务日志 中的REF
    4.4 Action 对应 业务日志中的 action
    4.5 Status 对应 业务日志中的 Status+Root Cause 两者拼接 (注意失败要标红)
    4.6 TABLE 对应 该项目作用的 SQL数据表名 如果涉及多个表格 (则需要用|隔开)
    4.7 Details 主要是涉及到服务器端对于本次操作的回应(可是代码, 需要你设计下,主要是说明这个操作的细则,注意不要重复说明已有列说过的内容)
    4.8 SQL/JSON 
        4.8.1 若是SQL操作 则对应 此次和数据进行交互的SQL代码, 若有多个 则用|隔开 (这个也是判定是否需要记录底层数据TAB的关键标准, 有SQL代码交互就是标准)
        4.8.2 若是JSON操作 则对应 此次写入JSON和之前不同的内容, 若有多个 则用|隔开 (这个也是判定是否需要记录底层数据TAB的关键标准, 有JSON文件交互就是标准)
    4.9 Type 除了 清空日志 的操作为Permanent 其他都是 Regular
    4.10 Note 为记录特殊原因的 例如日后功能中,需要在修改数据, 删除数据, 新增数据等等操作要求必填原因的项目
    4.11 Goback 回滚机制
        4.11.1 回顾机制为一个回滚数据库为上一次修改前的操作的机制 他作为一个按钮存在在最后一列
        4.11.2 回滚机制仅能运用于 涉及数据库表格的修改 新增 和 删除的相关记录, 仅查询 不做其他动作的则这个按钮为灰色
        4.11.3 当某个表格或多个表格在某次操作中 被修改(也就是和之前的内容不同时, 例如一个数据库原为空 写入数据 又删除数据在一个动作里 这种不算修改, 我们仅考虑动作执行结束后比对动作执行前是否有改变) 时 系统会做一个快照
        4.11.4 这里你需要一个公有类管理这个 这个公有类在日后功能中会被广泛采用, 用于2.11.3的这个快照记录
        4.11.5 快照的生成就是在对于数据库的产生修改的动作执行之前执行, 该快照只会备份涉及到操作的表格, 而不是整体, 回档的时候也是只会覆盖涉及的表格不是整体
        4.11.6 该快照记录保存于项目文件目录下 backup/goback/ 文件夹, 你的公有类也需要给该快照起名 我建议采用唯一的REF号命名, 再加入时间戳, 这样方便后续
        4.11.7 该快照仅只能保存最近10次操作, 最多保存90天, 超过数量会覆盖之前的数据 超过日期会删除记录, 当回档按钮对应的快照备份被删除的时候, 该按钮点击后会提示该备份因为什么原因被删除了 无法执行(这个不算出错, 无需再操作日志里记录为失败 也无需进入错误日志)
        4.11.8 注意按钮要和该行所对应的备份快照对应, 点击按钮 会触发密码机制 这个需要密码机制涉及到的 用户权限管理 密码策略矩阵 中也要能管理需要什么密码, 具体参考那个部分涉及 需要修改json文件 和引入那个公有类
        4.11.9 注意当点击回溯按钮之后 操作日志, 底层数据都要记录回溯这个操作, 但是底层数据这里仅会备份1次当前文件, 也就是撤销回溯, 撤销回溯之后, 不再备份撤销回溯之前的内容, 防止无限套娃
        4.11.10 确认回溯后生成的底层数据记录, 后面的按钮也从回溯变成撤销回溯, 点击后要警告用户此次撤销会撤销哪次回溯 要非常具体, 同时引入密码验证
        4.11.11 撤销回溯完成后, 也要完成 操作日志 底层数据的记录, 但是底层数据后按钮为灰色 因为这是撤销操作
        4.11.12 撤销回溯所需的快照文件存在 项目文件 back/goback_recall/文件夹中, 命名必须和其对应操作的在backup/goback/的名字一致
        4.11.13 撤销回溯的快照文件是跟随其对应的回溯操作中backup/goback/是一起管理的, 也就是当backup/goback/里的被删除的时候, back/goback_recall/也会被删除 在被删除后的按钮规则也同理

5. 系统故障TAB(改名为错误日志)
    当操作日志里列States出现Failed时, 不论是什么理由, 都会被同步记录到这里
    要实现以上功能 必须做到全站级别的错误捕捉, 包含前端后端的每个层面
    5.1 Patched 
        5.1.1 需要读取 patch_notes.txt里每一个patch, 要找的格式例如 [V1.0.0] 2025-08-10, 你只需要获取V1.0.0 也就是括号里的版本 所有选项作为这个列表的取值, 同时列表也具备一个选项叫做 无需修复 
        5.1.2 这个初始值为空
    5.2 Time: 依然是时间
    5.3 REF ID: 匹配 业务操作 里的REF ID
    5.4 MODULE: 记录错误来源的模块 (如果是模块, 若不是模块则是系统文件夹)
    5.5 UI/SERVER: 
        5.5.1 若错误来自于前端, 例如HTML,js,css, 级别的错误 例如404, 500这些 记录为 UI
        5.5.2 若错误来自于后端, 例如Python文件,或者其他系统文件例如json, txt造成的错误 记录为 SERVER
        5.5.3 若错误来自于数据库, 例如SQL错误 记录为 DATABASE
        5.5.4 若错误来自于网络, 或者用户访上传的数据格式不对, 则忽略 不需要从业务日志那边复制过来
    5.6 Stack Details: 记录错误发生时的所有后台的报错堆栈信息, 是显示在后端的全部错误信息都要录入

6. 前端报错页面展示
    6.1 前端如果访问出现错误, 不得再弹出报错窗口给用户 也不得展示报错信息 和 服务器堆栈信息, 而是弹出一个设计好的报错页面
    6.2 错误页面上需要明确告知用户这个错误是什么方面的, UI, 系统, 数据, 权限, 其他, 且当前报错的REF号是什么(如果存在), 提示用户去找管理员, 且提供一个按钮点击返回主页
    6.3 要捕捉号所有可能的错误 尤其是html的, 例如页面不存在等等 都需要整合进去
    6.4 主旨就是让用户不论任何错误情况都看不到任何代码和他们看不懂的信息
    6.5 后台需则需要实时显示错误
    6.6 若登录用户是super admin则不需要采用错误页面, 而采用常规的展示全部错误, 方便开发者工作

7. 整体性补充说明:
    7.1 业务操作, 系统故障, 错误日志 三个TAB顶上都需要具备一样的filter栏 用于筛选数据
    7.2 业务操作, 系统故障, 错误日志 三个TAB中的每条记录都可以点开一个modal查看详细信息 相当于一个页面直接展示所有信息的明细 方便开发者查看 
   



回到数据库运维板块
1. 这个是企业级的ERP软件 要过ISO认证 你在界面中 严禁暴露关键信息 例如文件名字, 文件名格式  这些都必须被隐藏掉 
2. 在按钮执行动作的时候 需要一个进度条 实时展示当前进度, 且在当前进度未完成的情况下, 按钮应该被禁用 并且标注是在进程中
3. 然后你需要测试这些按钮背后的功能都能用

我来给你简述一下这个数据库运费板块功能
1. 数据备份tab
    1.1 用户点击确认后会备份数据库表 Data_Clean_Log, Data_Inventory (给用户的提示是备份ebay销售数据和盘点库存记录)
    1.2 用户点恢复也是仅恢复这个表
    1.3 用户点击备份会触发密码矩阵管理
    1.4 此项功能同时受到职能开关管理
    1.5 此项功能备份的提信息为:请输入备份备注
    1.6 存储文件命名要按照时间戳来命名方便后续解析
    1.7 业务日志 需要做记录
2. 备份恢复tab
    2.1 用户点击恢复会触发密码矩阵管理
    2.2 此项功能同时受到职能开关管理
    2.3 验证通过之后读取备份覆盖当前Data_Clean_Log, Data_Inventory表 (给用户的提示是恢复ebay销售数据和盘点库存记录)
    2.4 业务日志 需要做记录
    2.5 底层数据 需要做记录, 因为涉及到数据库的写入, 所以也引入该TAB的回滚功能
3. 备份管理tab
    3.1 用户可以通过列表看到所有手动备份记录,这些记录不会根据10条和90天的限制被删除 用户不删除就永久存在
    3.2 列表中的备份文件必须解析为 YYYY-MM-DD HH-MM-SS 格式, 且显示备份备注(如果存在), 切记不能显示备份文件名字 这会引发安全漏洞
    3.3 用户点击单个备份后面的垃圾桶按钮可以删除备份
    3.4 点击删除触发密码矩阵管理
    3.5 该页面也受到职能开关管理
4. 数据清洗
    4.1 仅作用于数据库表 Data_Clean_Log, Data_Inventory (给用户的提示是备份ebay销售数据和盘点库存记录)
    4.2 用户选择要清洗的日期范围, 就会删除这两个表中这两个时间段内的全部数据
        4.2.1 Data_Clean_Log:
            第一列order date的值为该行记录的时间标签
            删除数据是按照匹配行删除
        4.2.2 Data_Inventory: 
            列名为该列数据的时间标签
            删除数据是按匹配列删除
    4.3 这里需要触发密码矩阵管理
    4.4 此项功能同时受到职能开关管理
    4.5 业务日志 需要做记录
    4.6 底层数据 需要做记录, 因为涉及到数据库的删除, 所以也引入该TAB的回滚功能

系统首页(不变)
数据上传(从导航栏里去掉 同时移除HUB页, 里面的TAB内容放入其他功能)
商业智能报表(从导航栏里去掉,移动到销售板块)
数据修改中心(从导航栏里去掉, 同时移除HUB页, 里面的的内容放入其他功能)
销售板块(新增HUB页, 放入原有的:数据上传->交易数据上传, 商业智能报表->报表生成器, 商业智能报表->报表中心, 数据交易可视化)
采购板块(新增HUB页, 但是先没有做内容, 先做出其hub页)
库存板块(新增HUB页, 放入原有的 数据上传->手动上传盘存, 数据修改中心->库存修改向导)
财务板块(新增HUB页, 但是先没有做内容, 先做出其hub页)
产品板块(新增HUB页, 放入原有的 数据修改中心->COGS档案维护,数据修改中心->批量新增SKU)
数据库运维板块(不变),
用户权限管理(不变),
安全审计日志(不变)

底部的用户部分不变


现在需要建立几个数据库表格
1. 采购订单表(in_po):
date_order: YYYY-MM-DD #采购订单日期, 需要用户录入
po_number: 文本 #采购订单号, 自动生成 格式供应商代号+日期YYYYMMDD+N## ##代表自增号, 当前面的供应商代号+日期YYYYMMDD重复时自增 例如XX20250103N01  意思为XX这个供应商2025年1月3日的第1个订单
supplier_code: 文本 #供应商代号, 需要用户录入 只能从列表里选, 列表源于in_supplier的supplier_code
SKU: 文本 #商品代号, 需要用户录入 只能从列表里选, 列表源于Data_COGS的SKU列
quantity: int #采购数量 不能为0或者负
price: float #采购价格 不能为负
FE_order: float #采购时的汇率 USD->RMB的当天的买入价 (这个是系统自动获取的)


2. 采购发货表(in_sending):
date_send: YYYY-MM-DD #发货日期, 需要用户输入
po_number: 文本 #采购订单号, 用户选择 来自于in_po的po_number列
SKU: 文本 #商品代号, 通过读取用户选择的po_number列的值 去过滤in_po的SKU列 生成的表格中选取
quantity: int #用户录入, 没有限制, 但是给用户提示, 提示原始订单数量是多少, 这个数量来自于 通过获取本表中本行的po_number,SKU去过滤in_po的quantity列获取
status: bool #收货状态, true为已收货, false为未收货, 默认值为false, 当用户在收货功能里点击收货的时候, 该值会变为true
date_receive: YYYY-MM-DD #实际收货日期, 默认值为null, 当用户在收货功能里点击收货的时候, 需要用户填写日期 (日期不能早过该行的date_send)
tracking_number: 文本 #物流单号, 需要用户输入

3. 发货物流管理(in_logistic):
tracking_number: 文本 #物流单号, 无需输入 自动对应in_sending的tracking_number
po_number: 文本 #采购订单号, 无需输入 自动对应in_sending的po_number
ETA_receive: YYYY-MM-DD #预计收货日期, 需要用户输入
weight: int #物流重量 需要用户输入, 单位为KG
price: float #物流价格 需要用户输入 意义为每公斤多少钱
currency: 文本 #物流价格货币 需要用户选择 (USD/RMB)
payment_Seq: int #支付批次 YYYYXXXX YYYY为年份 XXXX为支付批次从0001 开始自增
Payment_send_check: bool #

4. 供货商表(in_supplier):
supplier_code: 文本  #记录供应商代号
category: 文本  #记录供应商类别 (只能选E/A, E对应中文为 汽配, A对应中文为 亚马逊)
currency: 文本  #记录供应商收货货币币种 (RMB/USD)
float_currency: bool  #记录供应商收货货币是否浮动
float_threshold: float #记录供应商收货货币浮动启动阈值 (当汇率波动超过这个值时, 就会触发浮动规则)
depository: bool #记录是否需要定金
deposit_par: float #记录定金百分比 只在depository为true时有




5. 整单级定价策略(in_po_strategy): #这种是按照整体订单支付的策略
po_number: 文本
supplier_code: 文本
depository: bool
deposite_par: float
exchange_deposit: float #记录订单定金被支付时的汇率
exchange_tail: float #记录订单尾款被支付时的汇率
deposit_overwrite: float #记录实际定金金额, overwrite供货商的定金百分比算出来的金额
po_adj: float #记录订单整体调整金额 (正数为增加, 负数为减少)

6. 策略(in_strategy_send) #这种是按照发货单来支付策略







===========================================================================================================================================================

帮我修改这个数据库表(无视是否有数据), #号后面是每个字段的说明 方便你后面的功能理解
供货商表(in_supplier):
supplier_code: 文本  #记录供应商代号
supplier_name: 文本  #记录供应商对应的中文名称


新建第二个数据库表 #号后面是每个字段的说明 方便你后面的功能理解
供应商策略表(in_supplier_strategy):
supplier_code: 文本  #对应supplier_code
category: 文本  #记录供应商类别 (只能选E/A, E对应中文为 汽配, A对应中文为 亚马逊)
currency: 文本  #记录供应商收货货币币种 (RMB/USD)
float_currency: bool  #记录供应商收货货币是否浮动
float_threshold: float #记录供应商收货货币浮动启动阈值 (当汇率波动超过这个值时, 就会触发浮动规则)
depository: bool #记录是否需要定金
deposit_par: float #记录定金百分比 只在depository为true时有
status: bool #记录供应商状态 (true为active, false为inactive)
effective_date: YYYY-MM-DD HH:MM:SS #记录策略生效日期


同时修改 采购板块-增加供应商 的一些表格逻辑,
该页面类似于产品模块->批量新增SKU, 但是读取数据库表变成in_supplier的数据
该功能受到 确认提交的按钮受到 密码策略管理, 注意新建
该页面也收到 权限管理, 有权限才可以访问, 否则会上锁, 注意保持和其他功能一致性的多级列表上锁机制
该也UI界面设计需要满足和别的页面一直的色彩风格
操作成功失败的modal在操作失败时候(红色发光边框modal)会显示错误原因,并且点击确定会返回增加供应商页面刷新页面,强制不记住密码
且修改规则一次操作只让用户新增一个供应商, 不能批量新增, 新增成功之后弹出成功绿色modal后会让用户选择继续添加或者返回 采购板块HUB页面
我需要让用户录入这些信息的时候, 每个字段的提示信息, 都需要有中文提示
你不一定要采用批量新增SKU的界面的所有内容横版风格, 你要根据实际情况调整
我觉得最好是像个名片一样展示方式比较好

显示的列有以下内容(冒号后面是显示的中文名称, 注意当鼠标移动到该列表头名字时时会出现提示), 数据库表内的字段也有写入对应:

supplier_code: 供应商代号
提示内容为 请输入供货商名字代号(两个字母)
这个数据只接受两个英文字母, 非法字段不能被输入, 输入2个字母之后也不能再输入
且输入的两个字母不能和数据库表中该列已有的数据重复, 注意刷新机制
上传数据库时, 会自动检查, 遇到错误要弹出modal报错,详细说明错误原因

category: 供应商类别
提示内容为 请根据业务种类为供应商选择类别
开关按钮,用户可以选 汽配/亚马逊 中的一个
必选项目, 否则会弹出modal报错,详细说明错误原因

currency: 使用货币 
提示内容为 请根据供应商选择结算货币种类
开关按钮, 用户可以选 RMB/USD 中的一个
必选项目, 否则会弹出modal报错,详细说明错误原因

float_currency: 价格浮动
提示内容为 请根据供应商合同选择该供应商订单价格是否随汇率浮动阈值控制
开关按钮, 用户可以选开启或者关闭
必选项目, 否则会弹出modal报错,详细说明错误原因

float_threshold: 价格浮动阈值
提示内容为 请根据供应商合同选择该供应商订单价格随汇率浮动阈值
是一个拖动的滑块, 用户可以拖动选择0-100中的一个百分比
当检查到用户开启价格浮动时, 该字段内容才启用, 否则该内容为灰色不可交互, 用户点击modal报错,该字段内容不可修改,提示为价格浮动未开启, modal要有报警的红框闪烁
若价格浮动打开, 这个是必选项目, 否则会弹出modal报错,详细说明错误原因

depository: 要求定金
提示内容为 请根据供应商合同选择该供应商订单是否需要定金
开关按钮,用户可以选开启或者关闭
必选项目, 否则会弹出modal报错,详细说明错误原因

deposit_par: 定金百分比
提示内容为 请根据供应商合同选择该供应商订单定金百分比
是一个拖动的滑块, 用户可以拖动选择0-100中的一个百分比
当检查到用户开启定金时, 该字段内容才启用, 否则该内容为灰色不可交互, 用户点击modal报错,该字段内容不可修改,提示为定金未开启, modal要有报警的红框闪烁
若定金打开, 这个是必选项目, 否则会弹出modal报错,详细说明错误原因

status: 新增用户默认为active 不在该页面显示



===============================================================================================================================================================


===============================================================================================================================================================

帮我修改这个数据库表(无视是否有数据), #号后面是每个字段的说明 方便你后面的功能理解
供货商表(in_supplier):
supplier_code: 文本  #记录供应商代号
supplier_name: 文本  #记录供应商对应的中文名称
(其他列全删除, 同时删除该表内的所有记录)

新建一个数据库表 #号后面是每个字段的说明 方便你后面的功能理解

供应商策略表(in_supplier_strategy):
supplier_code: 文本  #对应supplier_code
category: 文本  #记录供应商类别 (只能选E/A, E对应中文为 汽配, A对应中文为 亚马逊)
currency: 文本  #记录供应商收货货币币种 (RMB/USD)
float_currency: bool  #记录供应商收货货币是否浮动
float_threshold: float #记录供应商收货货币浮动启动阈值 (当汇率波动超过这个值时, 就会触发浮动规则)
depository: bool #记录是否需要定金
deposit_par: float #记录定金百分比 只在depository为true时有
status: bool #记录供应商状态 (true为active, false为inactive)
effective_date: YYYY-MM-DD #记录策略生效日期
note: 文本 #记录策略备注


同时修改 采购板块-增加供应商 的一些表格逻辑(只修改表格逻辑, 也就是数据读取和写入的逻辑, 不修改UI界面, 我们只改变数据源于什么地方的位置)
新增的名片样式的框体内的做一定改变
供应商的代号 (原in_supplier表的supplier_code字段的规则完全不变, 尤其是查重机制, 新增一个写入in_supplier_strategy表的supplier_code字段)
供应商的名字(新增), 写入in_supplier表的supplier_name字段
    提示内容为 请输入供货商名字
    这个数据接受所有内容, 但是不可以为空
    上传数据库时, 会自动检查, 遇到错误要弹出modal报错,详细说明错误原因 
供应商类别: (修改写入内容的数据库位置) 写入in_supplier_strategy表的category字段
    其他所有保持原有样子啥也不变
使用货币: (修改写入内容的数据库位置) 写入in_supplier_strategy表的currency字段
    其他所有保持原有样子啥也不变
价格浮动: (修改写入内容的数据库位置) 写入in_supplier_strategy表的float_currency字段
    其他所有保持原有样子啥也不变  
价格浮动阈值: (修改写入内容的数据库位置) 写入in_supplier_strategy表的float_threshold字段
    其他所有保持原有样子啥也不变
定金: (修改写入内容的数据库位置) 写入in_supplier_strategy表的depository字段
    其他所有保持原有样子啥也不变
定金百分比: (修改写入内容的数据库位置) 写入in_supplier_strategy表的deposit_par字段
    其他所有保持原有样子啥也不变
状态: (修改写入内容的数据库位置) 写入in_supplier_strategy表的status字段
    其他所有保持原有样子啥也不变
生效日期: (新增) 写入in_supplier_strategy表的effective_date字段
    这个内容是无需显示在界面 也无需用户填写的, 
    上传数据库时, 会自动读取当前的时间 按照YYYY-MM-DD HH:MM:SS的格式写入对应表格中
note: (新增) 写入in_supplier_strategy表的note字段
    这个内容是无需显示在界面 也无需用户填写的, 
    在新增用户的时候, 会自动记录为: 默认策略

 
===============================================================================================================================================================   
  

现在在采购板块的HUB页建立1个TAB功能


1. 查看和修改供应商策略
该页面类似于采购板块 -  增加供应商, 内容来自于数据库表in_supplier_strategy和in_supplier
该功能受到 确认提交的按钮受到 密码策略管理, 注意新建(重要)
该页面也收到 权限管理, 有权限才可以访问, 否则会上锁, 注意保持和其他功能一致性的多级列表上锁机制(重要)
该也UI界面设计需要满足和采购板块 -  增加供应商一致的色彩风格(重要)
且修改规则一次操作只让用户修改一个供应商, 不能批量修改, 修改成功之后弹出成功绿色modal后会让用户返回查看和修改供应商策略页面刷新页面
我需要让用户录入和查看这些信息的时候, 每个字段的提示信息, 都需要有中文提示
所有要求密码的项目都会触发密码策略管理, 注意新建(重要), 且密码输入的modal必须都和采购板块 -  增加供应商里的密码策略输入密码的Modal保持一样的APPLE UI设计(重要)
操作成功失败的modal在操作失败时候(红色发光边框modal)会显示错误原因,并且点击确定会返回查看和修改供应商策略页面刷新页面,强制不记住密码

当用户打开页面的时候会出现一个表格预览全部的供应商信息, 这些信息来自于
读取数据库表in_supplier和in_supplier_strategy之后显示的列有以下内容(冒号后面是显示的中文名称, 注意当鼠标移动到该列表头名字时时会出现提示), 数据库表内的字段也有写入对应:

第一个页面是展示页面, 用户打开时展示表格内容(也就是现有的数据表内容展示, 注意有的信息展示要展示成为用户能看懂的内容 而不是直接展示数据库表的字段)
由于in_supplier_strategy表根据supplier_code可能存在单个供应商对应多个策略的情况, 所以我们需要加入策略生效日期(effective_date)来过滤, 只显示单个供应商的最新策略(和今天日期最近的)

列依次为:
供应商代号: supplier_code来自于in_supplier_strategy表 #鼠标移动到该列表头名字时时会出现提示: 供应商的公司内部代号
供应商名字: supplier_name来自于in_supplier表 (需要匹配supplier_code) #鼠标移动到该列表头名字时时会出现提示: 供应商的中文名字
策略生效日期: effective_date来自于in_supplier_strategy表 #鼠标移动到该列表头名字时时会出现提示: 供应商当前合作策略生效日
供应商类别: category来自于in_supplier_strategy表 #鼠标移动到该列表头名字时时会出现提示: 供应商的业务分类
使用货币: currency来自于in_supplier_strategy表  (RMB/USD) #鼠标移动到该列表头名字时时会出现提示: 供应商当接受付款的使用货币类别
价格浮动开关: float_currency来自于in_supplier_strategy表 (启用/禁用) #鼠标移动到该列表头名字时时会出现提示: 汇率波动是否影响价格
价格浮动阈值: float_threshold来自于in_supplier_strategy表 (显示百分比数, 若价格浮动为禁用, 则该字段 显示 该功能未启动) #鼠标移动到该列表头名字时时会出现提示: 汇率浮动超过阈值后会触发价格浮动,浮动比例跟随汇率浮动
定金开关: depository来自于in_supplier_strategy表 (启动/禁用) #鼠标移动到该列表头名字时时会出现提示: 供应商是否要求强制定金
定金百分比: deposit_par来自于in_supplier_strategy表 (显示百分比数, 若定金为禁用, 则该字段 显示 该功能未启动) #鼠标移动到该列表头名字时时会出现提示: 供应商要求定金比例,若为100%则表示供货商要求交货前全款
当前合作状态: status来自于in_supplier_strategy表 (显示为:合作方/非合作方) #鼠标移动到该列表头名字时时会出现提示: 当前是否还在和供货商合作
合作合同备注: note来自于in_supplier_strategy表 #鼠标移动到该列表头名字时时会出现提示: 供应商当前合作合同备注
合同文件: 这个是一个按钮, 打开会弹出一个页面, 里面会展示用户合同, 且用户可以有下载按钮下载, 或者直接在modal查看, 对应的路径为 backup/supplier_contract/供货商代号/最新合同文件 
    合同文件在这个文件夹里都会以时间戳命名(YYYYMMDD), 这个是用户上传时设定的. 文件可能是pdf,图片,excel,word等格式 所以你的modal需要能支持在线查看和下载
    在该页面下, 右侧需要有一个预览形式的框体,能看到文件多少页, 是竖直堆叠的, 左侧大页面查看文件的可以缩放 滚动, 记住我们要求把显示页面中的不同的页数的文件无缝连接在一起,中间不要有缝隙
    且该页面需要附带返回按钮, 该按钮点击后会关闭该页面, 且返回到查看和修改供应商策略页面
    此按钮点击后会触发 密码策略管理 通过验证才能打开这个合同文件的modal (你需要去新增这个密码策略管理)
修改供应商策略: 这个是一个按钮, 打开会打开一个新页面, 界面类似采购板块 -  增加供应商, 但是是展示当前供应商的策略信息,但是是以名片形式显示, 展示方式如同采购板块 -  增加供应商的
以下是需要展示的内容, 且内容根据规则可修改, 而内容显示根据用户选择的供应商代号来展示,雷同于在查看功能里的内容, 但是仅显示单个被选中的供应商, 我在下列每一项都会说明是否可以修改, 能录入的数据规则是什么, 录入的项目和数据库的对应, 和新增供应商功能类似,但是通过读取数据显示当前最新日期的信息:

supplier_code: 供应商代号 (对应表为in_supplier_strategy)
提示内容为 供货商名字代号(两个字母)
不可修改

supplier_name: 供应商名字 (对应表为in_supplier) (必选项目)
提示内容为 请修改供应商中文名字
可修改

category: 供应商类别 (对应表为in_supplier_strategy) (必选项目)
提示内容为 请根据业务种类为供应商修改类别
开关按钮,用户可以修改 汽配/亚马逊 中的一个
必选项目, 否则会弹出modal报错,详细说明错误原因

currency: 使用货币 (对应表为in_supplier_strategy) (必选项目)
提示内容为 请根据供应商修改结算货币种类
开关按钮, 用户可以修改 RMB/USD 中的一个
必选项目, 否则会弹出modal报错,详细说明错误原因

float_currency: 价格浮动 (对应表为in_supplier_strategy) (必选项目)
提示内容为 请根据供应商合同选择该供应商订单价格是否随汇率浮动阈值控制
开关按钮, 用户可以修改开启或者关闭
必选项目, 否则会弹出modal报错,详细说明错误原因

float_threshold: 价格浮动阈值 (对应表为in_supplier_strategy)
提示内容为 请修改阈值,汇率浮动超过阈值后会触发价格浮动,浮动比例跟随汇率浮动
是一个拖动的滑块, 用户可以拖动选择0-10中的一个百分比
当检查到用户开启价格浮动时, 该字段内容才启用, 否则该内容为灰色不可交互, 用户点击modal报错,该字段内容不可修改,提示为价格浮动未开启, modal要有报警的红框闪烁
若价格浮动打开, 这个是必选项目, 否则会弹出modal报错,详细说明错误原因

depository: 要求定金 (对应表为in_supplier_strategy) (必选项目)
提示内容为 请根据供应商合同修改该供应商订单是否需要定金
开关按钮,用户可以修改开启或者关闭
必选项目, 否则会弹出modal报错,详细说明错误原因

deposit_par: 定金百分比 (对应表为in_supplier_strategy)
提示内容为 请根据供应商合同修改该供应商订单定金比例,若为100%则表示供货商要求交货前全款
是一个拖动的滑块, 用户可以拖动选择0-100中的一个百分比
当检查到用户开启定金时, 该字段内容才启用, 否则该内容为灰色不可交互, 用户点击modal报错,该字段内容不可修改,提示为定金未开启, modal要有报警的红框闪烁
若定金打开, 这个是必选项目, 否则会弹出modal报错,详细说明错误原因

note: 合作合同备注 (对应表为in_supplier_strategy) (非必需项目)
提示内容为: 请给当前供应商合作合同备注 (非必须,若用户不填, 则会以:默认策略 这四个字写入)

effective_date: 策略生效日期 (对应表为in_supplier_strategy) (必选项目)
提示内容为 请选择供应商当前合作策略生效日
必选项目, 否则会弹出modal报错,详细说明错误原因
若用户选择的日期内在该供应商的名下已经存在, 则modal提示用户是否要覆盖, 触发密码策略 输入密码(这个要去对应板块新增) 此处若失败点击modal确定会关闭modal, 但是不刷新页面让用户继续重新修改数据


合同文件: (非必需项目) 
    这个是上传文件的框体和按钮,用户也可拖拽文件进去, 对应的保存路径为 backup/supplier_contract/供货商代号/最新合同文件 
    合同文件在这个文件夹里都会以时间戳命名(YYYYMMDD), 这个是上一个选项中的effective_date设定的. 文件可能是pdf,图片,excel,word等格式
    用户在最后确定上应用该厂商修改的时候, 需要保存进入对应保存路径中

status: 当前合作状态: (对应表为in_supplier_strategy) (必选项目)  
提示内容为 请修改供应商当前合作状态
必选项目, 否则会弹出modal报错,详细说明错误原因
这也是一个开关按钮, 用户可以修改开启或者关闭
注意 如果用户选择关闭, 则除了这一个字段, 其他所有字段都会变灰且不可修改. 

确认修改按钮
写入修改后的数据到对应数据库的对应字段, 这一步会触发密码策略, 通过密码策略后, 会保存修改后的数据, 且关闭modal, 返回到查看和修改供应商策略页面 错误采用通用的错误modal提示和错误原因提示, 回到修改页面
==================框架架构====================
1. 路由
首页 index
销售板块 sales
采购板块 purchase
库存板块 inventory
财务板块 finance
产品管理 product
分析及报表 report
数据库管理 database
安全审计日志 security



==================全局modal====================
概述: 
    1. 全站modal应用于全站,是一个公有的MODAL
    2. 不同modal在不同情况下触发, 有不同内容, 要注意modal的判定层面的拓展性
设计:
    1. 所有的modal的设计为苹果的UI设计风格, 有确定和返回两个按钮, 且边距padding必须一致
    2. modal的确定按钮是一个默认名字按钮, 当某个页面要求改名字的时候能改名字
    3. Modal按钮颜色默认颜色为, 操作成功的为绿色, 操作失败的为红色, 警告为黄色, 普通为蓝色, 也可在页面里面去自定义颜色
    4. Modal边框需要能发光, 操作成功的绿色是点亮, 操作失败的红色是闪烁, 警告的黄色是跑马灯绕圈, 普通的蓝色是无光
    5. Modal的标题由页面去定义, 默认为没有标题
    6. Modal的内容由Modal的种类去定义, 需要留有能够从页面传入内容的接口,能够根据页面的需求提示内容
    7. Modal的返回按钮,默认名字为返回上一级, 当某个页面要求改名字的时候能改名字
    8. Modal的确定按钮点击后, 会关闭modal, 并且回到modal触发前的页面, 且刷新这个页面, 清空页面内的所有的输入
    9. Modal的返回上一级按钮点击后, 会关闭modal, 并且回到上一级页面
    10. Modal位置必须居中, 且大小要能自动调节,避免文字挤压和非必要换行
    11. Modal的语言,描述等 必须说人话 能让人看得懂的

种类:
    1. 密码modal
        密码modal最全局中最常用的modal,属于警告类modal
        在某个可执行操作按钮, 或某个页面, 或者某流程中的某个步骤, 在密码策略中被要求密码时.必须触发密码modal. 通过验证才会继续加载
        密码Modal的标题默认为密码验证, 按钮默认为确定,返回 
        密码modal的密码验证和输入决定于 该项功能或者页面 的密码策略中的当前的勾选所有密码
        密码modal需要密码输入框和密码提示栏, 密码提示栏需要根据密码策略中的密码类型来显示  
        密码modal的内容需要提示 某项功能需要验证什么什么密码 
        密码modal的密码根据密码策略可能有4个密码要输入. 也可能没有密码要输入, 当没有密码输入时不需要弹出密码modal
        密码modal在弹出消失之后, 再被加载出来时所有之前输入进去的密码都得清空 重新输入 这是安全问题

    2. 确认modal
        确认modal用于提示用户操作成功, 属于操作成功类modal
        确认modal的标题默认为操作成功, 按钮默认为确定,返回 
        确认modal的信息默认为 某项操作成功

    3. 报错modal
        报错modal用于提示用户操作失败, 属于操作失败类modal
        报错modal的标题默认为操作失败, 按钮默认为确定(更名为重置),返回 
        报错modal的信息默认为 某项操作失败, 请确认信息后再操作
        报错modal需要错误信息提示栏, 用于显示错误信息 (错误信息的判定源于该页面的实际内容, 或者其他判定标准, 例如密码modal,密码验证失败, 某某项目输入不合规等)
        报错modal在提示操作不合规的时候需要提示用户合规操作是什么, 例如 某个项目只能输入数字,用户输入了字母

    4. 流程modal
        流程Modal用于页面中流程过程中的信息提示, 流程确认 等等, 需要比较强的拓展性
        流程Modal的标题默认为没有标题, 按钮默认为确定,返回 (确认为继续下一步,返回为) 
        流程Modal的信息必须听从页面的定义
    
    5. 自定义modal
        自定义modal用于页面去自定义内容 modal的样式 尺寸 颜色 信息, 按钮, 标题等等义
        自定义为高度自定义的modal, 需要极强拓展性, 必须有页面中去具体定义

==================全局UI公用====================
    1. 遮罩层
        遮罩层用于页面中遮罩层, 用于遮罩页面, 只针对页面
    2. toast
        toast用于页面中toast, 用于提示用户操作状态, 属于操作成功类toast
        toast没有只有 操作成功 和 操作失败 两个标题, 信息由页面去定义

    3. 处理向导
        处理向导用于页面中处理向导, 用于提示用户处理状态, 属于处理向导类
        处理向导的标题为 某某处理向导, 名字由页面去定义
        处理向导的 每个步骤由页面去定义 UI样式和效果你可以参考当下 销售板块 -  交易数据上传 里的 交易数据处理向导
        处理向导的 每个步骤的完成和失败 也是由页面去定义 在销售板块 -  交易数据上传 的 情况下加入红色边框和背景作为操作失败的情况
        尺寸可调节,不约定就是默认尺寸
    
    4. 文件上传
        文件上传用于页面中文件上传
        用户可以拖拽丢文件进去上传, 或者用户可以点击上传按钮选择文件上传
        文件上传的标题为 页面定义
        文件上传的 UI样式和效果你可以参考当下 销售板块 -  交易数据上传 里的 文件上传
    
    5 全局状态
        当前系统状态条（同步中、离线、接口异常）
        网络状态提示（offline/online）
        权限变更提示（例如“你的权限已更新，请刷新”）
        服务器时间
        语言切换 仅支持中英文
        全局状态必须在每个页面的右上角

    6.  全局错误报错
        当页面出错时, 会弹出错误报错
        1️⃣ 数据层错误（Database / Data）

            说明：
            该类错误指发生在数据库或数据存储层的问题，包括 SQL 执行失败、约束冲突、事务异常、死锁、连接或超时等。
            AI 在处理此类错误时，应优先帮助定位具体表、字段、查询指纹或数据对象，并明确这是数据层责任而非业务逻辑问题。

            2️⃣ 后端应用错误（Backend / Application）

            说明：
            该类错误指 Django / Python 后端在业务逻辑、权限判断、参数校验或流程状态中产生的异常或非法状态。
            AI 应重点分析异常堆栈、触发入口（view/function）、业务上下文和关键参数，并用于还原出错的业务流程。

            3️⃣ 异步任务错误（Async / Celery）

            说明：
            该类错误指由 Celery 异步任务执行引起的问题，包括任务异常、超时、重试耗尽、幂等冲突或任务链中断。
            AI 在此类错误中应关注 task_id、parent_task_id、任务名称、重试次数以及触发该任务的用户和业务对象，并通过 trace_id 串联调用链。

            4️⃣ 前端运行时错误（Frontend / JavaScript Runtime）

            说明：
            该类错误指浏览器中 JavaScript 执行阶段产生的异常，包括未捕获异常、Promise rejection、DOM API 调用错误等。
            AI 应帮助定位具体脚本文件、行号、调用栈、页面路由和用户操作步骤，以支持前端复现和修复。

            5️⃣ 前端结构与可用性错误（Frontend / HTML · CSS · DOM）

            说明：
            该类错误指 HTML、CSS 或 DOM 结构本身导致的页面或交互异常，即使没有抛出 JS 异常，但表现为“元素不可点击、被遮挡、布局错乱、内容缺失”等。
            AI 在处理该类问题时，应从页面结构、样式层级、可点击性和渲染状态角度分析原因，而不是仅查找代码异常。

            6️⃣ 网络与外部依赖错误（Network / External Dependency）

            说明：
            该类错误指由网络传输、代理/CDN、第三方服务或跨域等外部因素引起的失败，包括超时、连接失败、错误响应码或依赖服务异常。
            AI 应区分这是前端网络问题还是后端依赖问题，并关注请求路径、状态码、耗时、依赖名称及重试行为

    
================== 全局 UI / Modal 设计规范 ==================

说明
本规范用于指导 AI 设计和实现 ERP 系统中的全局 UI 与全局 Modal。
请 严格按照以下说明实现，不要自行新增未提及的 UI 类型、交互逻辑或默认行为。
如需扩展，请仅以“建议”形式标注，而不要直接实现。

语言要求（全局硬性规则）：

系统所有 UI 文案必须支持 中英文双语言

中英文内容必须严格分离管理，不得在同一字符串中混写

任何新增、修改或替换文案的行为，必须同时提供中文与英文版本

中英文文案需保持 语义、结构、层级一一对应，以支持统一国际化管理

一、全局 Modal（Global Modal）
1. 概述

全局 Modal 为 全站公有组件，只存在一套，不随页面重复加载

不同 Modal 在不同场景触发，内容和行为可配置

Modal 的判定逻辑必须具备良好拓展性，避免写死在页面中

所有 Modal 相关文案（标题、内容、按钮文本、提示语）必须遵循双语言规则

2. 统一设计规范（所有 Modal 必须遵守）

UI 风格统一为 苹果风格（Apple-like UI）

所有 Modal 必须包含 确定 和 返回 两个按钮

所有 Modal 的 padding、边距、圆角必须保持一致

确定按钮：

默认名称（中文）：确定

默认名称（英文）：Confirm

页面可自定义按钮名称（需同时提供中英文）

返回按钮：

默认名称（中文）：返回上一级

默认名称（英文）：Back

页面可自定义按钮名称（需同时提供中英文）

Modal 标题：

默认无标题

标题由页面定义，必须提供中英文版本

Modal 内容：

内容由 Modal 类型决定

必须支持页面传入自定义提示内容

所有提示内容 必须提供中英文

Modal 位置与尺寸：

必须始终居中

尺寸自适应内容

避免文字挤压和不必要换行

Modal 文案：

必须使用“人话”

用户无需技术背景即可理解

中英文均需满足可读性要求，不得机器直译拼凑

3. 按钮行为规范（硬性规则）

点击 确定按钮：

关闭 Modal

返回 Modal 触发前的页面

刷新该页面

清空页面内所有输入内容

点击 返回上一级按钮：

关闭 Modal

返回上一级页面

4. Modal 颜色与光效规范
类型	按钮颜色	边框光效
操作成功	绿色	常亮
操作失败	红色	闪烁
警告	黄色	跑马灯绕圈
普通	蓝色	无光

页面允许自定义颜色，但默认规则必须存在

不同语言环境下 颜色、光效规则保持一致

二、Modal 类型定义（均需支持中英文）
1️⃣ 密码 Modal（Password Modal）

类型：警告类 Modal

使用场景：

某功能 / 页面 / 流程步骤在密码策略中被要求验证密码时

行为规则：

只有在 存在密码输入要求时 才弹出

无需密码输入时，不得弹出

标题默认：

中文：密码验证

英文：Password Verification

按钮默认：

确定 / 返回

密码输入：

密码数量由当前功能或页面的密码策略决定

可能需要输入 1～4 个密码

必须包含：

密码输入框

密码提示栏（根据密码策略动态显示，中英文）

明确提示“当前操作需要验证哪些密码”（中英文）

安全规则：

Modal 关闭后再次打开，所有密码输入必须清空

2️⃣ 确认 Modal（Success Modal）

类型：操作成功类 Modal

标题默认：

中文：操作成功

英文：Operation Successful

按钮默认：确定 / 返回

默认内容：

中文：某项操作成功

英文：The operation was completed successfully

3️⃣ 报错 Modal（Error Modal）

类型：操作失败类 Modal

标题默认：

中文：操作失败

英文：Operation Failed

按钮默认：

确定（需更名为 重置 / Reset）

返回

默认内容：

中文：某项操作失败，请确认信息后再操作

英文：The operation failed. Please review the information and try again.

必须包含：

错误信息提示栏（中英文）

错误来源说明（中英文）

操作不合规时：

必须明确告知 正确操作方式（中英文）

4️⃣ 流程 Modal（Flow Modal）

用途：

流程中的提示、确认、过渡

标题：

默认无

页面定义（需中英文）

按钮默认：

确定 / 返回

内容：

完全由页面定义

必须支持中英文

要求：

拓展性强

不写死流程逻辑

5️⃣ 自定义 Modal（Custom Modal）

用途：

页面完全自定义内容、样式、尺寸、颜色、按钮、标题

特点：

高度自定义

语言要求：

页面在定义时 必须显式提供中英文文案

要求：

不破坏全局 Modal 架构

不影响其他 Modal 类型

三、全局 UI 公用组件（语言规则同样适用）
1️⃣ 遮罩层（Overlay）

用于遮罩页面

只作用于当前页面

2️⃣ Toast

用途：提示操作状态

类型：

操作成功

操作失败

标题固定：

中文：成功 / 失败

英文：Success / Failed

提示内容：

由页面定义

必须支持中英文

3️⃣ 处理向导（Processing Wizard）

用途：展示流程处理状态

标题：页面定义（中英文）

每个步骤：

内容、状态由页面定义

成功 / 失败状态文案需中英文

UI 参考：

销售板块 → 交易数据上传 → 交易数据处理向导

4️⃣ 文件上传

支持方式：

拖拽上传

点击选择文件

标题与提示文案：

页面定义

必须提供中英文

5️⃣ 全局状态栏（右上角，所有页面必须存在）

包含以下信息（均需中英文）：

当前系统状态（同步中 / 离线 / 接口异常）

网络状态（online / offline）

权限变更提示

服务器时间

语言切换（仅支持中 / 英）

四、全局错误弹出（Error Handling UI）

当页面发生错误时，必须弹出错误提示，并按以下 6 类错误归类处理：

数据层错误（Database / Data）

后端应用错误（Backend / Application）

异步任务错误（Async / Celery）

前端运行时错误（Frontend / JavaScript Runtime）

前端结构与可用性错误（Frontend / HTML · CSS · DOM）

网络与外部依赖错误（Network / External Dependency）

错误标题、提示语、操作说明 必须支持中英文

错误分类与展示逻辑需保持语言无关性，仅文案切换

================== 规范结束 ==================



前后端业务团队 请通过内部讨论 整合一下 再有业务主管审核后 集合处理一个新项目
第一阶段
深度分析一下我们的rollback 原有的内容是这样 但是若我下面的描述不符合的话 我们需要修改原有逻辑
这个设计到前端 与 后端的 修改

原理为 在涉及与SQL数据库的表格产生修改和删除的时候 在动作执行前 我们都会对被修改的数据库表执行一个备份操作叫rollback
首先你要深度理解这个rollback是否在现行的功能中有覆盖, 且覆盖后有TOAST提示
判定标准就是是否对数据库中的表有写入或者删除或者修改

需要查验的功能有下列板块 (没说就不需要rollback), 后面的数字代表了建立回档时使用的功能代号

销售板块-交易数据上传 S01 对应的是 上传ebay数据
采购板块-新增供应商 S01 对应的是 新增供应商
采购板块-策略管理 S02 对应的是 修改供应商合同策略
库存板块-手动上传盘存 I01 对应的是 手动上传盘存
库存板块-库存修改向导 I02 对应的是 库修改库存资料
产品板块-产品数据维护 P03 对应的是 修改产品数据
产品板块-新增产品 P04 对应的是 新增产品
数据库运维-数据恢复 D01 对应的是 数据库数据恢复
数据库运维-数据清洗 D02 对应的是 数据库数据清除
数据库运维-数据修改找回 D03 对应的是 数据库数据修改回档

每次操作数据库修改,写入,删除等涉及到数据库内容的时候 在执行之前都需要备份下列数据库表格
in_supplier, in_strategy, Data_Inventory, Data_COGS, Data_Clean_Log
由于日后我会新增更多的功能, 所以我希望把所有需要在操作时ROLLBACK备份的数据库表格写入一个json文件
同时, 操作功能对应的功能代号和对应的功能名字需要写入这个json文件,你注意我们写入的功能名字不能是板块名字,必须是和实际业务功能对应的名字  
该json文件需要放在data文件夹中去, 这样方便后续的维护
那么rollback备份时就会去备份数据库中被json文件中写入的表格 放在一个备份文件中 
存放rollback的文件夹为 backups/rollback
当rollback文件被存入对应文件夹的时候 都必须被命名为 YYYYMMDDHHMMSS-XXX.sql 这些对应了操作的日期和时间 XXX代表了建立回档时使用的功能代号
每个文件夹内的文件最多保存10个, 超出10个会自动删除最早的文件

当团队深入了解项目当前的rollback机制后, 需要根据上述要求去完善, 并且缺少rollback的项目需要添加, 同时注意toast的加入

第二阶段 在数据库运维中 引入新路由 加入新功能 数据修改找回

该功能设计需要采用 向导 公有页面进行流程设置 和 golbalmodal进行密码管理
由于需要密码管理, 所以也需要在 用户权限管理密码策略管理的对应板块添加
此功能也需要收到 配置权限管理, 所以也需要在 用户管理权限的配置权限中的 权限树里的对应板块添加 
此功能也需要严格的LOG 记录和其对应的记录规则监管, 详细log记录请参考log记录的相关功能

向导流程总共分为分为以下流程

选择回档->验证回档日期->完成回档

在选择回档操作中, 需要读取backups/rollback文件夹中所有的备份文件, 通过文件名YYYYMMDDHHMMSS-XXX.sql获取YYYY-MM-DD HH:MM:SS 显示为时间
同时需要读取YYYYMMDDHHMMSS-XXX.sql获取该文件的功能代号XXX, 通过XXX读取json文件 获取该代号对应的功能名字 显示在日期内容的下面为 操作内容: 功能名字
在验证回档日期中, 会读取该备份文件夹backups/rollback里所有文件的日期, 逻辑为要求用户必须先回档最近的操作才能继续回档更早的操作, 否则提示错误 则无法点击下一步, 按钮为灰色 无法交互
用户点击确认后 会弹出globalmodal的密码验证, 要求输入密码
若用户输入密码通过, 在回档前, 这里也要应用一次rollback, 但是记住, 如果用户选择回档的文件的XXX是DO3, 则无需在回档时创立一个rollback
然后用选取的备份文件中内容全量覆盖掉之前的数据库中的内容, 这里需要一个很漂亮的进度条动画 你去设计 APPLE UI风格, 实时显示进度
在完成回档中, 若用户没有通过密码验证, 提示, 无法点击完成回档, 因为密码错误, 两个按钮和之前采用这个公有页 向导的一致
若用户成功回档, 则提示成功, 两个按钮和之前采用这个公有页 向导的一致, 只需告诉用户删除的表格有多少数据 又写入多少数据, 表格名字需要脱敏
若成功回挡后创立了新的rollback, 需要toast提示创立了新的rollback, 且在页面中也需要提示用户创立了新的rollback 方便撤回修改
若成功回档后没有创立新的rollback, 则说明这是撤销之前的回档, 要在页面中提示用户这是撤销了之前的回档,无需建立新的备份

