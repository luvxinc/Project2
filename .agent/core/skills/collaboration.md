---
name: collaboration
description: 跨团队协作 SOP — 工程师之间的交接标准/依赖管理/讨论协议/冲突升级。
---

# 跨团队协作 (Cross-Team Collaboration)

> **每个工程师是专家, 但项目不会只有一个人。这个 SOP 定义他们怎么协作。**

---

## 1. 协作原则

| 原则 | 说明 |
|------|------|
| **接口先行** | 协作双方先约定接口 (DTO/API/Props), 再各自实现 |
| **依赖明确** | 每个任务的前置依赖必须写清楚 |
| **交接记录** | 每次交接都有记录 (什么时候, 给谁, 给了什么) |
| **问题上报** | 协作遇到冲突, 30 分钟解决不了 → 上报总工 |

---

## 2. 常见协作场景

### 2.1 数据→后端 (Schema 先行)

```
数据架构师                      后端架构师
    │                              │
    │  1. 设计 Schema              │
    │  2. 创建 Migration           │
    │  3. 交付:                    │
    │     - 表结构                  │
    │     - 字段说明                │
    │     - 索引/约束               │
    │─────── 交接 ─────────────────→│
    │                              │  4. 基于 Schema 创建 Entity
    │                              │  5. 创建 Repository
    │                              │  6. 创建 Service + Controller
```

### 2.2 后端→前端 (API 契约先行)

```
后端架构师                      前端架构师
    │                              │
    │  1. 设计 DTO                 │
    │  2. 实现 Controller          │
    │  3. 交付:                    │
    │     - API 路径               │
    │     - 请求/响应 DTO          │
    │     - 错误码                  │
    │─────── 交接 ─────────────────→│
    │                              │  4. 创建 API Client
    │                              │  5. 创建 React Query Hooks
    │                              │  6. 创建 UI 组件
```

### 2.3 安全→后端 (约束先行)

```
安全架构师                      后端架构师
    │                              │
    │  1. 定义权限矩阵             │
    │  2. 定义安全等级             │
    │  3. 交付:                    │
    │     - 哪些 API 需要什么权限    │
    │     - 审计日志要求            │
    │─────── 交接 ─────────────────→│
    │                              │  4. 添加 @PreAuthorize
    │                              │  5. 添加审计日志
```

---

## 3. 交接协议

### 3.1 交接记录格式

```markdown
## 🔄 交接记录

从: {交出方 Skill}
到: {接收方 Skill}
时间: {YYYY-MM-DD HH:MM}

### 交付物
- {文件/API/Schema/文档}

### 接口约定
- {DTO 结构 / API 路径 / 表结构}

### 注意事项
- {陷阱/约束/特殊要求}
```

### 3.2 交接验证

接收方收到交付物后, 必须:
```
[ ] 确认交付物完整
[ ] 确认接口约定清晰
[ ] 确认能基于交付物开始工作
[ ] 有问题立即反馈 (不要等到最后)
```

---

## 4. 内部讨论协议

### 4.1 何时触发团队讨论

| 场景 | 触发 |
|------|------|
| 架构决策 (多个可行方案) | 列出方案 → 分析优缺 → 选最优 |
| 技术分歧 (工程师意见不同) | 各自陈述 → 总工裁决 |
| 风险发现 (实现中发现新风险) | 评估影响 → 报告总工 |
| 需求疑问 (工程语言有歧义) | 收集问题 → 总工反馈 PM |

### 4.2 讨论格式

```markdown
## 💬 技术讨论: {主题}

### 背景
{为什么需要讨论}

### 方案
| 方案 | 优点 | 缺点 | 工作量 |
|------|------|------|--------|
| A    | ...  | ...  | S/M/L  |
| B    | ...  | ...  | S/M/L  |

### 决策
选择方案 {X}
理由: ...
决策人: 总工
```

---

## 5. 依赖管理

### 5.1 依赖类型

| 类型 | 说明 | 处理 |
|------|------|------|
| **硬依赖** | A 必须在 B 之前完成 | 严格排序 |
| **软依赖** | A 的接口约定后 B 可以并行 | 约定接口 → 并行 |
| **无依赖** | A 和 B 完全独立 | 并行执行 |

### 5.2 依赖可视化

```
Schema [数据] ──→ Entity [后端] ──→ API [后端] ──→ 前端页面 [前端]
                                         │
                              安全注解 [安全] ──→ 审计 [QA]
```

---

## 6. 冲突升级

```
工程师之间有分歧
    ↓
自行讨论 (≤ 5 分钟)
    ↓
解决 → 继续   未解决 → 上报总工
                         ↓
              总工介入协调
                         ↓
              总工做最终技术决策
                         ↓
              涉及需求变更 → 总工通知 PM → PM 与用户确认
```

---

*Version: 1.0.0 — Generic Core*
