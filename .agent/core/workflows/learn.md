---
description: 学 — 学习 GitHub 库并纳入工具库。Use when 需要对外部库做全量理解、差异评估、切片入库与可触发路由。
---

# /learn — 工具库学习工作流（严格版）

> 学习/更新结果必须使用：`core/templates/learn-ingestion-report-template.md`（固定结构：来源/入库结果/去重更新/UNKNOWN/证据）
> 核心原则：**不遗漏、不瞎猜**。未验证信息必须标注“未知/待确认”。

## §0 强制约束（100%理解门槛）

在进入“评估是否入库”前，必须完成：
1. 全仓结构扫描（目录/模块/入口/配置）
2. 核心逻辑链路覆盖（数据流、控制流、错误流）
3. 关键文档与源码交叉验证（README ≠ 真相，源码为准）
4. 覆盖清单签字：
   - [ ] 架构层
   - [ ] API/接口层
   - [ ] 数据/状态层
   - [ ] 测试/验证层
   - [ ] 运维/发布层（如有）

> 任一项未完成：禁止输出“已理解/可入库”。

## §1 学习输入

最小输入：
- GitHub 仓库 URL
- 目标用途（业务能力/工程能力/思维方法）
- 可选：指定优先模块

## §2 先审后引（臃肿库治理）

对大库先做审核再决定引入：
- 价值：是否补齐现有能力缺口
- 成本：学习成本/维护成本/噪音成本
- 风险：与现有规则冲突、版本漂移

结论三选一：
- 引入（全量）
- 引入（部分模块）
- 暂不引入（记录原因）

## §3 差异评估（我们已有什么、缺什么）

输出矩阵：
- 现有能力（已覆盖）
- 缺口能力（建议吸收）
- 重复能力（不重复入库，仅建立映射）

## §4 切片入库（模块化 + 严格篇幅控制）

路径：`.agent/warehouse/tools/{library-slug}/`

最小文件：
- `INDEX.md`
- `meta.json`（来源、版本、分类、关键词）
- `01-*.md / 02-*.md ...`（按模块切片）

切片要求：
- 每片写“何时加载 + 关键词 + 来源”
- 单片建议 < 6KB，硬上限 8KB
- 库级总量默认上限 40KB（超限必须再切片）
- 模块化命名（如 api/data/security/perf）

增量写入规则（强制）：
- 默认只追加增量切片，不重写整库
- 修改已有切片时仅改受影响段落，并保留来源版本号
- 任何“全量覆盖式改写”必须附理由与风险说明

## §5 来源可追溯（强制）

每个切片必须标注：
- source_repo
- source_path
- source_commit/tag
- extracted_at

若一个技能由多个库合并，必须列：
- `sources[]`（多源清单）
- 合并策略（保留/改写/冲突解决）

## §6 去重规则（强制）

- 命中“语义等价”内容：不新增正文，仅增加映射与权重
- 部分重合：仅增量切片
- 重复条目禁止新增，更新索引权重与来源指针

## §7 可触发路由（泛化引用 + 精简加载）

通过分类+关键词触发，不绑死单库：
- 分类：engineering/data/security/ux/platform/cognition
- 关键词：每模块维护触发词
- 路由：先 `warehouse/_CATALOG.md`，再跳对应库 `INDEX.md` 与切片

上下文控制（强制）：
- 先读 catalog + 目标库 INDEX，禁止直接加载整库
- 单次最多加载 2 个切片；超出需先做摘要再继续
- 命中臃肿模块时先加载“摘要切片”，必要时再钻取子切片

## §8 自动执行入口（推荐统一 wrapper）

```bash
core/scripts/library-learn-wrapper.sh <repo-url|slug> [category] [keywords-comma] [ref]
core/scripts/library-route-audit.sh
core/scripts/library-dedupe-audit.sh
```

判定逻辑：
- 输入 repo-url：若已存在则更新，否则学习入库
- 输入 slug：直接更新
- 用户明确“重学/全量重建”时可绕过自动判定，强制学习入库

## §9 交付物

- 入库目录 + 模块切片
- 差异评估报告（已有/缺口/重复）
- 去重报告（新增/合并/跳过）
- 来源清单（可追溯）

---

*Version: 1.1.0 — +100%理解门槛 + 来源追溯 + 先审后引 + 泛化路由*
