# ç”¨æˆ·æƒé™æ¨¡å— (User Admin Module)

## æ¨¡å—è·¯å¾„
- **Django App**: `backend/apps/user_admin/`
- **URL Prefix**: `/dashboard/user_admin/`
- **æƒé™å‰ç¼€**: `module.user_admin.*`

## å­æ¨¡å—æ¸…å•

### 1. ç”¨æˆ·ç®¡ç† (Users)
**è·¯å¾„**: `/dashboard/user_admin/`
**æƒé™**: `module.user_admin.users`

| åŠŸèƒ½ | ç±»å‹ | ä¼˜å…ˆçº§ | å½“å‰å®ç° |
|------|------|--------|----------|
| ç”¨æˆ·åˆ—è¡¨ | é¡µé¢ | P0 | è¡¨æ ¼ |
| ç”¨æˆ·è¯¦æƒ… | Modal | P0 | å¼¹çª— |
| ç¼–è¾‘æƒé™ | Modal | P0 | æ ‘å½¢é€‰æ‹© |
| é”å®š/è§£é” | API | P0 | çŠ¶æ€åˆ‡æ¢ |
| åˆ é™¤ç”¨æˆ· | API | P1 | è½¯åˆ é™¤ |

**å…³é”®è¡¨**:
- `auth_user` - Django å†…ç½®ç”¨æˆ·è¡¨
- `user_permissions` - ç”¨æˆ·æƒé™ (JSON)

**å¤æ‚åº¦**: ğŸŸ¡ ä¸­ç­‰

---

### 2. ç”¨æˆ·æ³¨å†Œ (Register)
**è·¯å¾„**: `/dashboard/user_admin/register/`
**æƒé™**: `module.user_admin.register`

| åŠŸèƒ½ | ç±»å‹ | ä¼˜å…ˆçº§ | å½“å‰å®ç° |
|------|------|--------|----------|
| æ³¨å†Œè¡¨å• | é¡µé¢ | P0 | è¡¨å• |
| åˆå§‹æƒé™åˆ†é… | è¡¨å• | P0 | æ ‘å½¢é€‰æ‹© |
| å¯†ç ç­–ç•¥ | åç«¯ | P0 | å¼ºåº¦æ ¡éªŒ |

**å¤æ‚åº¦**: ğŸŸ¢ ä½

---

### 3. å®‰å…¨ç­–ç•¥ (Security Policy)
**è·¯å¾„**: é›†æˆåœ¨ç”¨æˆ·ç®¡ç†ä¸­
**æƒé™**: Admin Only

| åŠŸèƒ½ | ç±»å‹ | ä¼˜å…ˆçº§ | å½“å‰å®ç° |
|------|------|--------|----------|
| å®‰å…¨ç ç®¡ç† | é¡µé¢ | P0 | L1-L4 é…ç½® |
| åŠŸèƒ½å¼€å…³ | é¡µé¢ | P1 | æ¨¡å—å¯ç”¨/ç¦ç”¨ |
| ç™»å½•ç­–ç•¥ | é…ç½® | P1 | Session è¶…æ—¶ |

**å…³é”®æœåŠ¡**:
- `SecurityPolicyManager` - å®‰å…¨ç­–ç•¥ç®¡ç†
- `AuthService` - è®¤è¯æœåŠ¡

**å¤æ‚åº¦**: ğŸ”´ é«˜ (å®‰å…¨æ ¸å¿ƒ)

---

### 4. è§’è‰²ç®¡ç† (Roles) - æœªå®ç°
**çŠ¶æ€**: âšª æœªå®ç°

| åŠŸèƒ½ | ç±»å‹ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|------|------|--------|------|
| è§’è‰²åˆ—è¡¨ | é¡µé¢ | P2 | å¯é€‰å®ç° |
| è§’è‰²æƒé™æ¨¡æ¿ | è¡¨å• | P2 | ç®€åŒ–æƒé™åˆ†é… |

---

## æƒé™ä½“ç³»æ¶æ„

```
æƒé™ç»“æ„ (4 å±‚)
â”œâ”€â”€ Module (æ¨¡å—)        ä¾‹: module.sales
â”‚   â”œâ”€â”€ Submodule (å­æ¨¡å—) ä¾‹: module.sales.transactions
â”‚   â”‚   â”œâ”€â”€ Tab (æ ‡ç­¾é¡µ)    ä¾‹: module.sales.transactions.upload
â”‚   â”‚   â”‚   â””â”€â”€ Action (åŠ¨ä½œ) ä¾‹: btn_upload_csv
```

**æƒé™å­˜å‚¨**:
- JSON æ ¼å¼å­˜å‚¨åœ¨ `user.permissions` å­—æ®µ
- æ”¯æŒç»§æ‰¿: æ‹¥æœ‰çˆ¶æƒé™ â‰  æ‹¥æœ‰æ‰€æœ‰å­æƒé™

**å®‰å…¨ç­‰çº§**:
| ç­‰çº§ | ä»£ç  | ç”¨é€” |
|------|------|------|
| L1 | SEC_CODE_QUERY | æŸ¥è¯¢æ“ä½œ |
| L2 | SEC_CODE_MODIFY | ä¿®æ”¹æ“ä½œ |
| L3 | SEC_CODE_DB | æ•°æ®åº“æ“ä½œ |
| L4 | SEC_CODE_SYSTEM | ç³»ç»Ÿçº§æ“ä½œ |

---

## API ç«¯ç‚¹æ¸…å•

| Method | Path | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|--------|------|------|--------|
| GET | `/user_admin/` | Hub é¡µé¢ | P0 |
| GET | `/user_admin/users/` | ç”¨æˆ·åˆ—è¡¨ | P0 |
| GET | `/user_admin/users/<id>/` | ç”¨æˆ·è¯¦æƒ… | P0 |
| POST | `/user_admin/users/<id>/permissions/` | æ›´æ–°æƒé™ | P0 |
| POST | `/user_admin/users/<id>/lock/` | é”å®šç”¨æˆ· | P0 |
| POST | `/user_admin/users/<id>/unlock/` | è§£é”ç”¨æˆ· | P0 |
| GET | `/user_admin/register/` | æ³¨å†Œé¡µé¢ | P0 |
| POST | `/user_admin/register/submit/` | æäº¤æ³¨å†Œ | P0 |

---

## è¿ç§»æ³¨æ„äº‹é¡¹

### å¤æ‚åº¦è¯„ä¼°: ğŸ”´ é«˜

| é£é™©ç‚¹ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| è®¤è¯ç³»ç»Ÿ | éœ€è¦å®Œå…¨é‡å†™ | NestJS + Passport |
| æƒé™å­˜å‚¨ | JSON â†’ RBAC è¡¨ | è®¾è®¡æ–°çš„æƒé™è¡¨ |
| å®‰å…¨ç­–ç•¥ | æ ¸å¿ƒå®‰å…¨é€»è¾‘ | é€è¡Œå¯¹ç…§ç§»æ¤ |
| Session | Django Session | JWT æˆ– Cookie |

### å»ºè®®è¿ç§»é¡ºåº
1. **ç¬¬ä¸€ä¸ªè¿ç§»**: è¿™æ˜¯æ‰€æœ‰æ¨¡å—çš„ä¾èµ–
2. å…ˆå®ç°åŸºç¡€è®¤è¯ (ç™»å½•/ç™»å‡º)
3. å†å®ç°æƒé™ä½“ç³»
4. æœ€åå®ç°ç”¨æˆ·ç®¡ç† UI

---

*Last Updated: 2026-02-04*
